<div class="container mx-auto px-4 py-8">
	<h1 class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-8 flex items-center gap-2">
	  <i class="fas fa-key"></i> Permission Management
	</h1>

	<div class="mb-6 flex justify-between items-center">
	  <a href="/admin/roles" class="inline-flex items-center px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-md transition">
		<i class="fas fa-arrow-left mr-2"></i> Back to Roles
	  </a>
	  <div class="text-sm text-gray-600 dark:text-gray-400">
		Total: <%= Object.values(permissionsByModule).reduce((total, perms) => total + perms.length, 0) %> permissions
	  </div>
	</div>

	<% if (typeof permissionsByModule !== 'undefined' && Object.keys(permissionsByModule).length > 0) { %>
	  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
		<% Object.keys(permissionsByModule).forEach(module => { %>
		  <div class="bg-white dark:bg-gray-800 rounded-lg shadow">
			<div class="px-6 py-4 border-b border-gray-200 dark:border-gray-700">
			  <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-100 flex items-center gap-2">
				<i class="fas fa-folder text-blue-500"></i>
				<%= module.charAt(0).toUpperCase() + module.slice(1).replace('_', ' ') %>
				<span class="inline-flex items-center justify-center w-6 h-6 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-sm font-semibold">
				  <%= permissionsByModule[module].length %>
				</span>
			  </h2>
			</div>
			<div class="p-6">
			  <div class="space-y-4">
				<% permissionsByModule[module].forEach(permission => { %>
				  <div class="border border-gray-200 dark:border-gray-600 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition">
					<div class="flex items-start justify-between">
					  <div class="flex-1">
						<h3 class="font-medium text-gray-900 dark:text-gray-100">
						  <%= permission.display_name %>
						</h3>
						<p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
						  <%= permission.name %>
						</p>
						<% if (permission.description) { %>
						  <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">
							<%= permission.description %>
						  </p>
						<% } %>
					  </div>
					  <div class="ml-4 flex items-center">
						<span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-sm font-semibold" title="Used by <%= permission.role_count %> roles">
						  <%= permission.role_count %>
						</span>
					  </div>
					</div>
					<div class="mt-3 flex items-center justify-between text-xs text-gray-500 dark:text-gray-400">
					  <span>
						<i class="fas fa-clock mr-1"></i>
						Created: <%= new Date(permission.created_at).toLocaleDateString() %>
					  </span>
					</div>
				  </div>
				<% }) %>
			  </div>
			</div>
		  </div>
		<% }) %>
	  </div>
	<% } else { %>
	  <div class="flex flex-col items-center justify-center py-16 text-center border border-dashed border-gray-400 rounded bg-gray-50 dark:bg-gray-950 mt-8">
		<div class="text-4xl text-gray-400 mb-2">
		  <i class="fas fa-key"></i>
		</div>
		<h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-1">No permissions found</h3>
		<p class="text-gray-500 dark:text-gray-400">Permissions are automatically created by the system.</p>
	  </div>
	<% } %>

	<!-- Permission Usage Statistics -->
	<% if (typeof permissionsByModule !== 'undefined' && Object.keys(permissionsByModule).length > 0) { %>
	  <div class="mt-8 bg-white dark:bg-gray-800 rounded-lg shadow p-6">
		<h2 class="text-lg font-semibold text-gray-800 dark:text-gray-100 mb-4 flex items-center gap-2">
		  <i class="fas fa-chart-bar"></i> Permission Statistics
		</h2>
		<div class="grid grid-cols-1 md:grid-cols-4 gap-4">
		  <div class="bg-blue-50 dark:bg-blue-900 rounded-lg p-4">
			<div class="flex items-center">
			  <div class="flex-shrink-0">
				<i class="fas fa-key text-blue-500 text-2xl"></i>
			  </div>
			  <div class="ml-4">
				<div class="text-2xl font-bold text-blue-600 dark:text-blue-300">
				  <%= Object.values(permissionsByModule).reduce((total, perms) => total + perms.length, 0) %>
				</div>
				<div class="text-sm text-blue-600 dark:text-blue-300">Total Permissions</div>
			  </div>
			</div>
		  </div>

		  <div class="bg-green-50 dark:bg-green-900 rounded-lg p-4">
			<div class="flex items-center">
			  <div class="flex-shrink-0">
				<i class="fas fa-folder text-green-500 text-2xl"></i>
			  </div>
			  <div class="ml-4">
				<div class="text-2xl font-bold text-green-600 dark:text-green-300">
				  <%= Object.keys(permissionsByModule).length %>
				</div>
				<div class="text-sm text-green-600 dark:text-green-300">Modules</div>
			  </div>
			</div>
		  </div>

		  <div class="bg-yellow-50 dark:bg-yellow-900 rounded-lg p-4">
			<div class="flex items-center">
			  <div class="flex-shrink-0">
				<i class="fas fa-users text-yellow-500 text-2xl"></i>
			  </div>
			  <div class="ml-4">
				<div class="text-2xl font-bold text-yellow-600 dark:text-yellow-300">
				  <%= Object.values(permissionsByModule).reduce((total, perms) =>
					total + perms.reduce((sum, p) => sum + Number(p.role_count || 0), 0), 0) %>
				</div>
				<div class="text-sm text-yellow-600 dark:text-yellow-300">Total Assignments</div>
			  </div>
			</div>
		  </div>

		  <div class="bg-purple-50 dark:bg-purple-900 rounded-lg p-4">
			<div class="flex items-center">
			  <div class="flex-shrink-0">
				<i class="fas fa-chart-line text-purple-500 text-2xl"></i>
			  </div>
			  <div class="ml-4">
				<%
				  const totalAssignments = Object.values(permissionsByModule).reduce(
					(total, perms) => total + perms.reduce((sum, p) => sum + Number(p.role_count || 0), 0), 0
				  );
				  const totalPermissions = Object.values(permissionsByModule).reduce(
					(total, perms) => total + perms.length, 0
				  );
				  const avgUsage = totalPermissions > 0 ? Math.round(totalAssignments / totalPermissions) : 0;
				%>
				<div class="text-2xl font-bold text-purple-600 dark:text-purple-300">
				  <%= avgUsage %>
				</div>
				<div class="text-sm text-purple-600 dark:text-purple-300">Avg. Usage</div>
			  </div>
			</div>
		  </div>
		</div>
	  </div>
	<% } %>
  </div>
