<div class="container mx-auto px-4 py-8">
	<h1 class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-8 flex items-center gap-2">
	  <i class="fas fa-user-shield"></i> Role Management
	</h1>

	<div class="mb-6 flex justify-between items-center">
	  <% if (can('roles.create')) { %>
		<a href="/admin/roles/add" class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-md transition">
		  <i class="fas fa-plus mr-2"></i> Add New Role
		</a>
	  <% } else { %>
		<button disabled class="inline-flex items-center px-4 py-2 bg-gray-400 text-gray-600 font-semibold rounded-md cursor-not-allowed opacity-60" title="You don't have permission to create roles">
		  <i class="fas fa-plus mr-2"></i> Add New Role
		</button>
	  <% } %>

	  <% if (can('roles.view') || can('roles.edit')) { %>
		<a href="/admin/permissions" class="inline-flex items-center px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-md transition">
		  <i class="fas fa-key mr-2"></i> View Permissions
		</a>
	  <% } else { %>
		<button disabled class="inline-flex items-center px-4 py-2 bg-gray-400 text-gray-600 font-semibold rounded-md cursor-not-allowed opacity-60" title="You don't have permission to view permissions">
		  <i class="fas fa-key mr-2"></i> View Permissions
		</button>
	  <% } %>
	</div>

	<% if (typeof roles !== 'undefined' && roles && roles.length > 0) { %>
	  <div class="overflow-x-auto bg-white dark:bg-gray-800 rounded-lg shadow">
		<table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
		  <thead class="bg-gray-50 dark:bg-gray-900">
			<tr>
			  <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200">Role Name</th>
			  <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200">Description</th>
			  <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200">Type</th>
			  <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200">Users</th>
			  <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200">Permissions</th>
			  <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200">Created</th>
			  <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200">Actions</th>
			</tr>
		  </thead>
		  <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
			<% roles.forEach(role => { %>
			  <tr>
				<td class="px-4 py-3">
				  <div class="flex items-center gap-2">
					<span class="font-medium text-gray-800 dark:text-gray-100"><%= role.display_name %></span>
					<% if (role.is_system_role) { %>
					  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300">
						<i class="fas fa-lock mr-1"></i> System
					  </span>
					<% } %>
				  </div>
				  <div class="text-sm text-gray-500 dark:text-gray-400"><%= role.name %></div>
				</td>
				<td class="px-4 py-3 text-gray-700 dark:text-gray-200">
				  <%= role.description || 'No description' %>
				</td>
				<td class="px-4 py-3">
				  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold
					<%= role.is_system_role
					  ? 'bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 border border-purple-200 dark:border-purple-700'
					  : 'bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 border border-blue-200 dark:border-blue-700' %>">
					<i class="fas <%= role.is_system_role ? 'fa-cog' : 'fa-user-tag' %> mr-1"></i>
					<%= role.is_system_role ? 'System' : 'Custom' %>
				  </span>
				</td>
				<td class="px-4 py-3 text-center">
				  <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-sm font-semibold">
					<%= role.user_count %>
				  </span>
				</td>
				<td class="px-4 py-3 text-center">
				  <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-sm font-semibold">
					<%= role.permission_count %>
				  </span>
				</td>
				<td class="px-4 py-3 text-gray-600 dark:text-gray-400">
				  <%= new Date(role.created_at).toLocaleDateString() %>
				</td>
				<td class="px-4 py-3">
				  <div class="flex flex-wrap gap-2">
					<!-- Edit Button -->
					<% if (can('roles.edit')) { %>
					  <a href="/admin/roles/<%= role.id %>/edit" class="inline-flex items-center px-2 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded transition text-xs" title="Edit">
						<i class="fas fa-edit"></i>
					  </a>
					<% } else { %>
					  <button disabled class="inline-flex items-center px-2 py-1 bg-gray-400 text-gray-600 rounded cursor-not-allowed opacity-60 text-xs" title="You don't have permission to edit roles">
						<i class="fas fa-edit"></i>
					  </button>
					<% } %>

					<!-- Delete Button -->
					<% if (can('roles.delete') && !role.is_system_role) { %>
					  <form style="display: inline;" method="POST" action="/admin/roles/<%= role.id %>/delete"
							onsubmit="return confirm('Are you sure you want to delete this role? This action cannot be undone.')">
						<button type="submit"
						  class="inline-flex items-center px-2 py-1 bg-red-500 hover:bg-red-600 text-white rounded transition text-xs"
						  title="Delete">
						  <i class="fas fa-trash"></i>
						</button>
					  </form>
					<% } else if (!can('roles.delete')) { %>
					  <button disabled class="inline-flex items-center px-2 py-1 bg-gray-400 text-gray-600 rounded cursor-not-allowed opacity-60 text-xs" title="You don't have permission to delete roles">
						<i class="fas fa-trash"></i>
					  </button>
					<% } else if (role.is_system_role) { %>
					  <button disabled class="inline-flex items-center px-2 py-1 bg-gray-400 text-gray-600 rounded cursor-not-allowed opacity-60 text-xs" title="System roles cannot be deleted">
						<i class="fas fa-trash"></i>
					  </button>
					<% } %>
				  </div>
				</td>
			  </tr>
			<% }) %>
		  </tbody>
		</table>
	  </div>
	<% } else { %>
	  <div class="flex flex-col items-center justify-center py-16 text-center border border-dashed border-blue-400 rounded bg-blue-50 dark:bg-blue-950 mt-8">
		<div class="text-4xl text-blue-500 mb-2">
		  <i class="fas fa-user-shield"></i>
		</div>
		<h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-1">No roles found</h3>
		<p class="text-gray-500 dark:text-gray-400">Start by creating your first custom role.</p>
		<% if (can('roles.create')) { %>
		  <a href="/admin/roles/add" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-md transition flex items-center gap-2 mt-4">
			<i class="fas fa-plus"></i> Add New Role
		  </a>
		<% } else { %>
		  <button disabled class="px-4 py-2 bg-gray-400 text-gray-600 font-semibold rounded-md cursor-not-allowed opacity-60 flex items-center gap-2 mt-4" title="You don't have permission to create roles">
			<i class="fas fa-plus"></i> Add New Role
		  </button>
		<% } %>
	  </div>
	<% } %>
  </div>
