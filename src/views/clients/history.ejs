<div class="container mx-auto px-4 py-8">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
    <div>
      <h1 class="text-2xl font-bold text-gray-800 dark:text-gray-100 flex items-center gap-2 mb-1">
        <i class="fas fa-history"></i> Client History
      </h1>
      <p class="text-gray-500 dark:text-gray-400">History for: <strong><%= client.name %></strong> (<%= client.client_id %>)</p>
    </div>
    <div>
      <a href="/clients/<%= client.id %>" class="inline-flex items-center px-4 py-2 bg-gray-300 dark:bg-gray-700 hover:bg-gray-400 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-100 font-semibold rounded-md transition">
        <i class="fas fa-arrow-left mr-2"></i> Back to Client
      </a>
    </div>
  </div>

  <% if (history.length === 0) { %>
    <div class="flex flex-col items-center justify-center py-16 text-center border border-dashed border-blue-400 rounded bg-blue-50 dark:bg-blue-950">
      <div class="text-4xl text-blue-500 mb-2">
        <i class="fas fa-history"></i>
      </div>
      <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-1">No history found</h3>
      <p class="text-gray-500 dark:text-gray-400">No actions have been recorded for this client yet.</p>
    </div>
  <% } else { %>
    <div class="relative border-l-4 border-blue-200 dark:border-blue-900 pl-6">
      <% history.forEach(entry => { %>
        <div class="mb-10 flex items-start gap-4 relative">
          <div class="absolute -left-8 top-0">
            <span class="
              flex items-center justify-center w-8 h-8 rounded-full border-2
              <% if (entry.action_type === 'created') { %>
                bg-green-100 dark:bg-green-900 border-green-400 dark:border-green-700 text-green-700 dark:text-green-300
              <% } else if (entry.action_type === 'updated') { %>
                bg-yellow-100 dark:bg-yellow-900 border-yellow-400 dark:border-yellow-700 text-yellow-700 dark:text-yellow-300
              <% } else if (entry.action_type === 'deleted') { %>
                bg-red-100 dark:bg-red-900 border-red-400 dark:border-red-700 text-red-700 dark:text-red-300
              <% } else { %>
                bg-gray-100 dark:bg-gray-900 border-gray-400 dark:border-gray-700 text-gray-700 dark:text-gray-300
              <% } %>
            ">
              <% if (entry.action_type === 'created') { %>
                <i class="fas fa-plus"></i>
              <% } else if (entry.action_type === 'updated') { %>
                <i class="fas fa-edit"></i>
              <% } else if (entry.action_type === 'deleted') { %>
                <i class="fas fa-trash"></i>
              <% } else { %>
                <i class="fas fa-info"></i>
              <% } %>
            </span>
          </div>
          <div class="flex-1 bg-white dark:bg-gray-800 rounded-lg shadow p-6 ml-2">
            <div class="flex items-center justify-between mb-2">
              <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-100">
                <%= entry.action_type.charAt(0).toUpperCase() + entry.action_type.slice(1) %>
              </h4>
              <span class="text-xs text-gray-500 dark:text-gray-400">
                <i class="fas fa-clock"></i>
                <%= new Date(entry.created_at).toLocaleString() %>
              </span>
            </div>
            <div class="mb-2">
              <% if (entry.performed_by_name) { %>
                <span class="text-sm text-gray-600 dark:text-gray-300">
                  <strong>Performed by:</strong> <%= entry.performed_by_name %>
                </span>
              <% } %>
            </div>
            <% if (entry.action_details) { %>
              <div class="text-sm">
                <% if (entry.action_type === 'created') { %>
                  <p class="mb-1">Client created with the following information:</p>
                  <ul class="list-disc pl-6">
                    <% if (entry.action_details.client_id) { %>
                      <li><strong>Client ID:</strong> <%= entry.action_details.client_id %></li>
                    <% } %>
                    <% if (entry.action_details.name) { %>
                      <li><strong>Name:</strong> <%= entry.action_details.name %></li>
                    <% } %>
                    <% if (entry.action_details.description) { %>
                      <li><strong>Description:</strong> <%= entry.action_details.description %></li>
                    <% } %>
                  </ul>
                <% } else if (entry.action_type === 'updated' && entry.action_details.changes) { %>
                  <p class="mb-1">The following changes were made:</p>
                  <ul class="list-disc pl-6">
                    <% Object.keys(entry.action_details.changes).forEach(field => { %>
                      <% const change = entry.action_details.changes[field]; %>
                      <li>
                        <strong><%= field.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) %>:</strong>
                        <span class="text-gray-500 dark:text-gray-400">"<%= change.from || 'empty' %>"</span>
                        <span class="mx-1 text-blue-600 dark:text-blue-400">&rarr;</span>
                        <span class="text-green-700 dark:text-green-300">"<%= change.to || 'empty' %>"</span>
                      </li>
                    <% }); %>
                  </ul>
                <% } else if (entry.action_type === 'deleted') { %>
                  <p>Client was deleted</p>
                <% } else { %>
                  <pre class="bg-gray-100 dark:bg-gray-900 rounded p-2 mt-2 overflow-x-auto text-xs"><%= JSON.stringify(entry.action_details, null, 2) %></pre>
                <% } %>
              </div>
            <% } %>
          </div>
        </div>
      <% }); %>
    </div>
  <% } %>
</div>
