<div class="container mx-auto px-4 py-8">
  <!-- Header -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
    <div>
      <h1 class="text-2xl font-bold text-gray-800 dark:text-gray-100 flex items-center gap-2">
        <i class="fas fa-building"></i> Client Management
      </h1>
    </div>
    <div>
      <a href="/clients/new" class="inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-md transition">
        <i class="fas fa-plus mr-2"></i> Add New Client
      </a>
    </div>
  </div>

  <% if (locals.messages && messages.success) { %>
    <div class="mb-4 flex items-center gap-2 px-4 py-3 rounded-lg bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 border border-green-200 dark:border-green-700">
      <i class="fas fa-check-circle"></i>
      <%= messages.success %>
    </div>
  <% } %>

  <% if (locals.messages && messages.error) { %>
    <div class="mb-4 flex items-center gap-2 px-4 py-3 rounded-lg bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200 border border-red-200 dark:border-red-700">
      <i class="fas fa-exclamation-triangle"></i>
      <%= messages.error %>
    </div>
  <% } %>

  <div class="flex items-center justify-between mb-4">
    <span class="text-gray-700 dark:text-gray-200 text-sm">
      Showing <%= clients.length %> of <%= totalClients %> clients
    </span>
  </div>

  <div class="overflow-x-auto bg-white dark:bg-gray-800 rounded-lg shadow">
    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
      <thead class="bg-gray-50 dark:bg-gray-900">
        <tr>
          <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200">Client ID</th>
          <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200">Name</th>
          <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200">Description</th>
          <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200"><i class="fas fa-print"></i> Printers</th>
          <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200"><i class="fas fa-mobile-alt"></i> PDAs</th>
          <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200">Created</th>
          <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
        <% if (clients.length === 0) { %>
          <tr>
            <td colspan="7" class="text-center px-4 py-8">
              <div class="flex flex-col items-center justify-center py-8 text-center border border-dashed border-blue-400 rounded bg-blue-50 dark:bg-blue-950">
                <div class="text-4xl text-blue-500 mb-2">
                  <i class="fas fa-building"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-1">No clients found</h3>
                <p class="text-gray-500 dark:text-gray-400 mb-4">Start by adding your first client.</p>
                <a href="/clients/new" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-md transition flex items-center gap-2">
                  <i class="fas fa-plus"></i> Add New Client
                </a>
              </div>
            </td>
          </tr>
        <% } else { %>
          <% clients.forEach(client => { %>
            <tr>
              <td class="px-4 py-3">
                <a href="/clients/<%= client.id %>" class="font-mono text-blue-700 dark:text-blue-300 hover:underline">
                  <%= client.client_id %>
                </a>
              </td>
              <td class="px-4 py-3 font-semibold text-gray-800 dark:text-gray-100"><%= client.name %></td>
              <td class="px-4 py-3">
                <span class="text-gray-500 dark:text-gray-400">
                  <%= client.description ? (client.description.length > 50 ? client.description.substring(0, 50) + '...' : client.description) : 'No description' %>
                </span>
              </td>
              <td class="px-4 py-3">
                <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 text-xs font-semibold">
                  <i class="fas fa-print"></i> <%= client.printer_count || 0 %>
                </span>
              </td>
              <td class="px-4 py-3">
                <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 text-xs font-semibold">
                  <i class="fas fa-mobile-alt"></i> <%= client.pda_count || 0 %>
                </span>
              </td>
              <td class="px-4 py-3 text-gray-500 dark:text-gray-400">
                <%= new Date(client.created_at).toLocaleDateString() %>
              </td>
              <td class="px-4 py-3">
                <div class="flex flex-wrap gap-2">
                  <a href="/clients/<%= client.id %>" class="inline-flex items-center px-2 py-1 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-100 rounded transition" title="View Details">
                    <i class="fas fa-eye"></i>
                  </a>
                  <a href="/clients/<%= client.id %>/edit" class="inline-flex items-center px-2 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded transition" title="Edit">
                    <i class="fas fa-edit"></i>
                  </a>
                  <a href="/clients/<%= client.id %>/history" class="inline-flex items-center px-2 py-1 bg-yellow-500 hover:bg-yellow-600 text-white rounded transition" title="View History">
                    <i class="fas fa-history"></i>
                  </a>
                  <button class="inline-flex items-center px-2 py-1 bg-red-500 hover:bg-red-600 text-white rounded transition" onclick="confirmDelete(<%= client.id %>, '<%= client.name %>')" title="Delete">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
          <% }); %>
        <% } %>
      </tbody>
    </table>
  </div>

  <% if (totalPages > 1) { %>
    <div class="flex justify-center mt-8">
      <nav aria-label="Page navigation">
        <ul class="inline-flex items-center -space-x-px">
          <% if (currentPage > 1) { %>
            <li>
              <a class="px-3 py-1 rounded-l bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-100 transition" href="?page=<%= currentPage - 1 %>">
                <i class="fas fa-chevron-left"></i> Previous
              </a>
            </li>
          <% } %>
          <% for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) { %>
            <li>
              <a class="px-3 py-1 border border-gray-300 dark:border-gray-700 <%= i === currentPage ? 'bg-blue-600 text-white' : 'bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-100 hover:bg-gray-100 dark:hover:bg-gray-700' %> transition" href="?page=<%= i %>">
                <%= i %>
              </a>
            </li>
          <% } %>
          <% if (currentPage < totalPages) { %>
            <li>
              <a class="px-3 py-1 rounded-r bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-100 transition" href="?page=<%= currentPage + 1 %>">
                Next <i class="fas fa-chevron-right"></i>
              </a>
            </li>
          <% } %>
        </ul>
      </nav>
    </div>
  <% } %>

  <script>
    function confirmDelete(clientId, clientName) {
      if (confirm(`Are you sure you want to delete the client "${clientName}"? This action cannot be undone.`)) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/clients/${clientId}/delete`;
        document.body.appendChild(form);
        form.submit();
      }
    }
  </script>
</div>
