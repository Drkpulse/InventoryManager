<div class="content-header">
  <div class="header-title">
    <h1><i class="fas fa-building"></i> <%= client.name %></h1>
    <p>Client ID: <strong><%= client.client_id %></strong></p>
  </div>
  <div class="header-actions">
    <a href="/clients" class="btn btn-secondary">
      <i class="fas fa-arrow-left"></i> Back to Clients
    </a>
    <a href="/clients/<%= client.id %>/edit" class="btn btn-primary">
      <i class="fas fa-edit"></i> Edit Client
    </a>
  </div>
</div>

<% if (locals.messages && messages.success) { %>
  <div class="alert alert-success">
    <i class="fas fa-check-circle"></i>
    <%= messages.success %>
  </div>
<% } %>

<div class="details-container">
  <div class="info-section">
    <h3><i class="fas fa-info-circle"></i> Client Information</h3>
    <div class="info-grid">
      <div class="info-item">
        <label>Client ID:</label>
        <span><%= client.client_id %></span>
      </div>
      <div class="info-item">
        <label>Name:</label>
        <span><%= client.name %></span>
      </div>
      <div class="info-item">
        <label>Description:</label>
        <span><%= client.description || 'No description provided' %></span>
      </div>
      <div class="info-item">
        <label>Created:</label>
        <span><%= new Date(client.created_at).toLocaleString() %></span>
      </div>
      <div class="info-item">
        <label>Last Updated:</label>
        <span><%= new Date(client.updated_at).toLocaleString() %></span>
      </div>
    </div>
  </div>

  <div class="equipment-section">
    <div class="section-header">
      <h3><i class="fas fa-print"></i> Printers (<%= printers.length %>)</h3>
      <a href="/printers/new?client_id=<%= client.id %>" class="btn btn-sm btn-primary">
        <i class="fas fa-plus"></i> Add Printer
      </a>
    </div>
    
    <% if (printers.length === 0) { %>
      <div class="empty-state">
        <i class="fas fa-print"></i>
        <p>No printers assigned to this client</p>
        <a href="/printers/new?client_id=<%= client.id %>" class="btn btn-primary">Add Printer</a>
      </div>
    <% } else { %>
      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Supplier</th>
              <th>Employee</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% printers.forEach(printer => { %>
              <tr>
                <td>
                  <a href="/printers/<%= printer.id %>" class="entity-link">
                    #<%= printer.id %>
                  </a>
                </td>
                <td><%= printer.supplier %></td>
                <td>
                  <% if (printer.employee_name) { %>
                    <%= printer.employee_name %>
                  <% } else { %>
                    <span class="text-muted">Unassigned</span>
                  <% } %>
                </td>
                <td><%= new Date(printer.created_at).toLocaleDateString() %></td>
                <td>
                  <div class="action-buttons">
                    <a href="/printers/<%= printer.id %>" class="btn btn-sm btn-outline-primary">
                      <i class="fas fa-eye"></i>
                    </a>
                    <a href="/printers/<%= printer.id %>/edit" class="btn btn-sm btn-outline-secondary">
                      <i class="fas fa-edit"></i>
                    </a>
                  </div>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    <% } %>
  </div>

  <div class="equipment-section">
    <div class="section-header">
      <h3><i class="fas fa-mobile-alt"></i> PDAs (<%= pdas.length %>)</h3>
      <a href="/pdas/new?client_id=<%= client.id %>" class="btn btn-sm btn-primary">
        <i class="fas fa-plus"></i> Add PDA
      </a>
    </div>
    
    <% if (pdas.length === 0) { %>
      <div class="empty-state">
        <i class="fas fa-mobile-alt"></i>
        <p>No PDAs assigned to this client</p>
        <a href="/pdas/new?client_id=<%= client.id %>" class="btn btn-primary">Add PDA</a>
      </div>
    <% } else { %>
      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Serial Number</th>
              <th>Model</th>
              <th>Cost</th>
              <th>Status</th>
              <th>SIM Cards</th>
              <th>Created</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% pdas.forEach(pda => { %>
              <tr>
                <td>
                  <a href="/pdas/<%= pda.id %>" class="entity-link">
                    <%= pda.serial_number %>
                  </a>
                </td>
                <td><%= pda.model || '-' %></td>
                <td>
                  <% if (pda.cost) { %>
                    €<%= parseFloat(pda.cost).toFixed(2) %>
                  <% } else { %>
                    -
                  <% } %>
                </td>
                <td>
                  <% if (pda.status_name) { %>
                    <span class="badge badge-info"><%= pda.status_name %></span>
                  <% } else { %>
                    -
                  <% } %>
                </td>
                <td>
                  <span class="badge badge-secondary">
                    <i class="fas fa-sim-card"></i> <%= pda.sim_count || 0 %>
                  </span>
                </td>
                <td><%= new Date(pda.created_at).toLocaleDateString() %></td>
                <td>
                  <div class="action-buttons">
                    <a href="/pdas/<%= pda.id %>" class="btn btn-sm btn-outline-primary">
                      <i class="fas fa-eye"></i>
                    </a>
                    <a href="/pdas/<%= pda.id %>/edit" class="btn btn-sm btn-outline-secondary">
                      <i class="fas fa-edit"></i>
                    </a>
                  </div>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    <% } %>
  </div>

  <div class="equipment-section">
    <div class="section-header">
      <h3><i class="fas fa-sim-card"></i> SIM Cards (<%= simCards.length %>)</h3>
      <a href="/simcards/new?client_id=<%= client.id %>" class="btn btn-sm btn-primary">
        <i class="fas fa-plus"></i> Add SIM Card
      </a>
    </div>
    
    <% if (simCards.length === 0) { %>
      <div class="empty-state">
        <i class="fas fa-sim-card"></i>
        <p>No SIM cards assigned to this client</p>
        <a href="/simcards/new?client_id=<%= client.id %>" class="btn btn-primary">Add SIM Card</a>
      </div>
    <% } else { %>
      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>SIM Number</th>
              <th>Carrier</th>
              <th>Monthly Cost</th>
              <th>Status</th>
              <th>Assigned PDA</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% simCards.forEach(sim => { %>
              <tr>
                <td>
                  <a href="/simcards/<%= sim.id %>" class="entity-link">
                    <%= sim.sim_number %>
                  </a>
                </td>
                <td><%= sim.carrier %></td>
                <td>
                  <% if (sim.monthly_cost) { %>
                    €<%= parseFloat(sim.monthly_cost).toFixed(2) %>/month
                  <% } else { %>
                    -
                  <% } %>
                </td>
                <td>
                  <% if (sim.status_name) { %>
                    <span class="badge badge-info"><%= sim.status_name %></span>
                  <% } else { %>
                    -
                  <% } %>
                </td>
                <td>
                  <% if (sim.pda_serial) { %>
                    <%= sim.pda_serial %>
                  <% } else { %>
                    <span class="text-muted">Unassigned</span>
                  <% } %>
                </td>
                <td>
                  <div class="action-buttons">
                    <a href="/simcards/<%= sim.id %>" class="btn btn-sm btn-outline-primary">
                      <i class="fas fa-eye"></i>
                    </a>
                  </div>
                </td>
              </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    <% } %>
  </div>

  <div class="cost-summary">
    <h3><i class="fas fa-calculator"></i> Cost Summary</h3>
    <div class="cost-grid">
      <div class="cost-item">
        <label>Printers Total:</label>
        <span>€<%= totals.printers.toFixed(2) %></span>
      </div>
      <div class="cost-item">
        <label>PDAs Total:</label>
        <span>€<%= totals.pdas.toFixed(2) %></span>
      </div>
      <div class="cost-item">
        <label>SIM Cards (Monthly):</label>
        <span>€<%= totals.simCards.toFixed(2) %>/month</span>
      </div>
      <div class="cost-item total">
        <label>Equipment Total:</label>
        <span>€<%= totals.total.toFixed(2) %></span>
      </div>
    </div>
  </div>

  <div class="actions-section">
    <a href="/clients/<%= client.id %>/history" class="btn btn-info">
      <i class="fas fa-history"></i> View History
    </a>
    <button class="btn btn-danger" onclick="confirmDelete(<%= client.id %>, '<%= client.name %>')">
      <i class="fas fa-trash"></i> Delete Client
    </button>
  </div>
</div>

<script>
function confirmDelete(clientId, clientName) {
  if (confirm(`Are you sure you want to delete the client "${clientName}"? This will also delete all associated printers and PDAs. This action cannot be undone.`)) {
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = `/clients/${clientId}/delete`;
    document.body.appendChild(form);
    form.submit();
  }
}
</script>