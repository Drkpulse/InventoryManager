<div class="page-container">
  <div class="page-header-simple">
    <div class="header-title-section">
      <div class="breadcrumb-nav">
        <a href="/employees" class="breadcrumb-link">
          <i class="fas fa-users"></i> Employees
        </a>
        <i class="fas fa-chevron-right breadcrumb-separator"></i>
        <a href="/employees/<%= employee.id %>" class="breadcrumb-link">
          <%= employee.name %>
        </a>
        <i class="fas fa-chevron-right breadcrumb-separator"></i>
        <span class="breadcrumb-current">History</span>
      </div>
      <h1>Employee History</h1>
      <div class="employee-meta">
        <span class="employee-id-display"><%= employee.cep %></span>
        <span class="employee-name-display"><%= employee.name %></span>
      </div>
    </div>
    <div class="header-actions">
      <div class="action-buttons">
        <a href="/employees/<%= employee.id %>" class="btn btn-secondary">
          <i class="fas fa-arrow-left"></i> Back to Employee
        </a>
        <a href="/employees/<%= employee.id %>/edit" class="btn btn-warning">
          <i class="fas fa-edit"></i> Edit Employee
        </a>
        <button onclick="exportHistory()" class="btn btn-info">
          <i class="fas fa-download"></i> Export History
        </button>
        <button onclick="printHistory()" class="btn btn-success">
          <i class="fas fa-print"></i> Print History
        </button>
      </div>
    </div>
  </div>

  <div class="content-section">
    <div class="history-container">
      <!-- History Filters -->
      <div class="history-filters">
        <div class="filter-group">
          <label for="actionFilter">Filter by Action</label>
          <select id="actionFilter" class="form-select">
            <option value="">All Actions</option>
            <option value="created">Employee Created</option>
            <option value="updated">Profile Updated</option>
            <option value="assigned">Item Assigned</option>
            <option value="unassigned">Item Unassigned</option>
            <option value="deleted">Employee Deleted</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="typeFilter">History Type</label>
          <select id="typeFilter" class="form-select">
            <option value="">All Types</option>
            <option value="employee">Employee Changes</option>
            <option value="item">Item Activities</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="dateFilter">Filter by Date</label>
          <div class="date-range">
            <input type="date" id="dateFrom" class="form-input" placeholder="From">
            <span>to</span>
            <input type="date" id="dateTo" class="form-input" placeholder="To">
          </div>
        </div>

        <div class="filter-group">
          <label for="userFilter">Filter by User</label>
          <select id="userFilter" class="form-select">
            <option value="">All Users</option>
            <% if (typeof users !== 'undefined') { %>
              <% users.forEach(user => { %>
                <option value="<%= user.id %>"><%= user.name %></option>
              <% }) %>
            <% } %>
          </select>
        </div>

        <div class="filter-actions">
          <button id="applyHistoryFilters" class="btn btn-primary">
            <i class="fas fa-search"></i> Apply Filters
          </button>
          <button id="resetHistoryFilters" class="btn btn-secondary">
            <i class="fas fa-times"></i> Reset
          </button>
        </div>
      </div>

      <!-- History Stats -->
      <div class="history-stats">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-history"></i>
          </div>
          <div class="stat-content">
            <span class="stat-number"><%= history ? history.length : 0 %></span>
            <span class="stat-label">Total Events</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-calendar"></i>
          </div>
          <div class="stat-content">
            <span class="stat-number">
              <% if (history && history.length > 0) { %>
                <%= Math.ceil((new Date() - new Date(history[history.length - 1].created_at)) / (1000 * 60 * 60 * 24)) %>
              <% } else { %>
                0
              <% } %>
            </span>
            <span class="stat-label">Days Since First Event</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-user-cog"></i>
          </div>
          <div class="stat-content">
            <span class="stat-number">
              <%
                const profileChanges = history ? history.filter(h => h.history_type === 'employee' && h.action_type === 'updated').length : 0;
              %>
              <%= profileChanges %>
            </span>
            <span class="stat-label">Profile Changes</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-laptop"></i>
          </div>
          <div class="stat-content">
            <span class="stat-number">
              <%
                const itemActivities = history ? history.filter(h => h.history_type === 'item').length : 0;
              %>
              <%= itemActivities %>
            </span>
            <span class="stat-label">Item Activities</span>
          </div>
        </div>
      </div>

      <!-- History Timeline -->
      <div class="history-timeline-container">
        <% if (history && history.length > 0) { %>
          <div class="history-timeline">
            <%
              // Pagination setup
              const currentPage = typeof page !== 'undefined' ? parseInt(page) : 1;
              const itemsPerPage = typeof perPage !== 'undefined' ? parseInt(perPage) : 10;
              const totalItems = history.length;
              const totalPages = Math.ceil(totalItems / itemsPerPage);
              const startIndex = (currentPage - 1) * itemsPerPage;
              const endIndex = Math.min(startIndex + itemsPerPage, totalItems);
              const paginatedHistory = history.slice(startIndex, endIndex);

              // Helper function to get action styling
              function getActionStyle(actionType, historyType) {
                if (historyType === 'employee') {
                  switch(actionType) {
                    case 'created':
                      return { icon: 'fas fa-user-plus', color: 'success', bgColor: '#d4edda' };
                    case 'updated':
                      return { icon: 'fas fa-user-edit', color: 'info', bgColor: '#d1ecf1' };
                    case 'deleted':
                      return { icon: 'fas fa-user-times', color: 'danger', bgColor: '#f8d7da' };
                    default:
                      return { icon: 'fas fa-user', color: 'secondary', bgColor: '#f8f9fa' };
                  }
                } else {
                  switch(actionType) {
                    case 'assigned':
                      return { icon: 'fas fa-arrow-right', color: 'primary', bgColor: '#cce7ff' };
                    case 'unassigned':
                      return { icon: 'fas fa-arrow-left', color: 'warning', bgColor: '#fff3cd' };
                    default:
                      return { icon: 'fas fa-laptop', color: 'secondary', bgColor: '#f8f9fa' };
                  }
                }
              }

              // Helper function to get time ago
              function getTimeAgo(date) {
                const now = new Date();
                const diffInMs = now - date;
                const diffInMinutes = Math.floor(diffInMs / (1000 * 60));
                const diffInHours = Math.floor(diffInMs / (1000 * 60 * 60));
                const diffInDays = Math.floor(diffInMs / (1000 * 60 * 60 * 24));
                const diffInWeeks = Math.floor(diffInDays / 7);
                const diffInMonths = Math.floor(diffInDays / 30);
                const diffInYears = Math.floor(diffInDays / 365);

                if (diffInMinutes < 1) return 'Just now';
                if (diffInMinutes < 60) return `${diffInMinutes}m ago`;
                if (diffInHours < 24) return `${diffInHours}h ago`;
                if (diffInDays < 7) return `${diffInDays}d ago`;
                if (diffInWeeks < 4) return `${diffInWeeks}w ago`;
                if (diffInMonths < 12) return `${diffInMonths}mo ago`;
                return `${diffInYears}y ago`;
              }
            %>

            <% paginatedHistory.forEach((entry, index) => { %>
              <%
                const actionStyle = getActionStyle(entry.action_type, entry.history_type);
                const entryDate = new Date(entry.created_at);
                const timeAgo = getTimeAgo(entryDate);
              %>
              <div class="history-entry <%= entry.history_type %>-entry" data-action="<%= entry.action_type %>">
                <div class="history-marker">
                  <div class="history-icon <%= actionStyle.color %>" style="background-color: <%= actionStyle.bgColor %>;">
                    <i class="<%= actionStyle.icon %>"></i>
                  </div>
                  <% if (index < paginatedHistory.length - 1) { %>
                    <div class="history-line"></div>
                  <% } %>
                </div>

                <div class="history-content">
                  <div class="history-card">
                    <div class="history-header">
                      <div class="history-title">
                        <span class="action-badge <%= actionStyle.color %>">
                          <i class="<%= actionStyle.icon %>"></i>
                          <%= formatActionType ? formatActionType(entry.action_type, entry.history_type) : entry.action_type %>
                        </span>
                        <% if (entry.history_type === 'item' && entry.item_name) { %>
                          <span class="item-reference">
                            <i class="fas fa-laptop"></i>
                            <%= entry.item_name %>
                            <% if (entry.cep_brc) { %>
                              (<%= entry.cep_brc %>)
                            <% } %>
                          </span>
                        <% } %>
                        <span class="history-time">
                          <i class="fas fa-clock"></i>
                          <%= entryDate.toLocaleString('en-US', {
                            year: 'numeric',
                            month: 'short',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                          }) %>
                        </span>
                      </div>
                      <div class="history-meta">
                        <span class="time-ago" title="<%= entryDate.toLocaleString() %>">
                          <%= timeAgo %>
                        </span>
                      </div>
                    </div>

                    <div class="history-body">
                      <% if (entry.action_type === 'created' && entry.history_type === 'employee') { %>
                        <div class="action-description">
                          <i class="fas fa-user-plus"></i>
                          <strong>Employee profile was created</strong>
                        </div>
                        <% if (entry.action_details) { %>
                          <div class="employee-details">
                            <% if (entry.action_details.email) { %>
                              <div class="detail-item">
                                <span class="detail-label">Email:</span>
                                <span class="detail-value">
                                  <i class="fas fa-envelope"></i>
                                  <%= entry.action_details.email %>
                                </span>
                              </div>
                            <% } %>
                            <% if (entry.action_details.department_name) { %>
                              <div class="detail-item">
                                <span class="detail-label">Department:</span>
                                <span class="detail-value">
                                  <i class="fas fa-building"></i>
                                  <%= entry.action_details.department_name %>
                                </span>
                              </div>
                            <% } %>
                            <% if (entry.action_details.location_name) { %>
                              <div class="detail-item">
                                <span class="detail-label">Location:</span>
                                <span class="detail-value">
                                  <i class="fas fa-map-marker-alt"></i>
                                  <%= entry.action_details.location_name %>
                                </span>
                              </div>
                            <% } %>
                            <% if (entry.action_details.joined_date) { %>
                              <div class="detail-item">
                                <span class="detail-label">Start Date:</span>
                                <span class="detail-value">
                                  <i class="fas fa-calendar-plus"></i>
                                  <%= new Date(entry.action_details.joined_date).toLocaleDateString() %>
                                </span>
                              </div>
                            <% } %>
                            <% if (entry.action_details.software_assigned && entry.action_details.software_assigned.length > 0) { %>
                              <div class="detail-item full-width">
                                <span class="detail-label">Initial Software:</span>
                                <div class="software-list">
                                  <% entry.action_details.software_assigned.forEach(software => { %>
                                    <span class="software-badge">
                                      <i class="fas fa-laptop-code"></i>
                                      <%= software %>
                                    </span>
                                  <% }) %>
                                </div>
                              </div>
                            <% } %>
                          </div>
                        <% } %>

                      <% } else if (entry.action_type === 'updated' && entry.history_type === 'employee') { %>
                        <div class="action-description">
                          <i class="fas fa-user-edit"></i>
                          <strong>Employee profile was updated</strong>
                        </div>
                        <% if (entry.action_details && Object.keys(entry.action_details).length > 0) { %>
                          <div class="changes-container">
                            <% for(const [field, change] of Object.entries(entry.action_details || {})) { %>
                              <% if (field !== 'updated_by') { %>
                                <div class="change-item">
                                  <% if (field === 'software_changes') { %>
                                    <div class="change-field">
                                      <i class="fas fa-laptop-code"></i>
                                      <strong>Software Changes</strong>
                                    </div>
                                    <div class="software-changes">
                                      <% if (change.added && change.added.length > 0) { %>
                                        <div class="added-software">
                                          <span class="change-type added">
                                            <i class="fas fa-plus-circle"></i>
                                            Added:
                                          </span>
                                          <div class="software-list">
                                            <% change.added.forEach(software => { %>
                                              <span class="software-badge success">
                                                <i class="fas fa-laptop-code"></i>
                                                <%= software %>
                                              </span>
                                            <% }) %>
                                          </div>
                                        </div>
                                      <% } %>
                                      <% if (change.removed && change.removed.length > 0) { %>
                                        <div class="removed-software">
                                          <span class="change-type removed">
                                            <i class="fas fa-minus-circle"></i>
                                            Removed:
                                          </span>
                                          <div class="software-list">
                                            <% change.removed.forEach(software => { %>
                                              <span class="software-badge danger">
                                                <i class="fas fa-laptop-code"></i>
                                                <%= software %>
                                              </span>
                                            <% }) %>
                                          </div>
                                        </div>
                                      <% } %>
                                    </div>
                                  <% } else if (typeof change === 'object' && change.from !== undefined) { %>
                                    <div class="change-field">
                                      <i class="fas fa-arrow-right"></i>
                                      <strong><%= formatFieldName ? formatFieldName(field) : field %></strong>
                                    </div>
                                    <div class="change-values">
                                      <span class="old-value">
                                        <i class="fas fa-minus-circle"></i>
                                        "<%= formatFieldValue ? formatFieldValue(change.from) : (change.from || 'Empty') %>"
                                      </span>
                                      <i class="fas fa-long-arrow-alt-right change-arrow"></i>
                                      <span class="new-value">
                                        <i class="fas fa-plus-circle"></i>
                                        "<%= formatFieldValue ? formatFieldValue(change.to) : (change.to || 'Empty') %>"
                                      </span>
                                    </div>
                                  <% } %>
                                </div>
                              <% } %>
                            <% } %>
                          </div>
                        <% } %>

                      <% } else if (entry.action_type === 'assigned' && entry.history_type === 'item') { %>
                        <div class="action-description">
                          <i class="fas fa-arrow-right"></i>
                          <strong>Item was assigned to this employee</strong>
                        </div>
                        <div class="assignment-details">
                          <div class="item-card">
                            <div class="item-header">
                              <span class="item-id-badge">
                                <i class="fas fa-tag"></i>
                                <%= entry.cep_brc %>
                              </span>
                              <span class="item-name"><%= entry.item_name %></span>
                            </div>
                            <% if (entry.action_details && entry.action_details.date) { %>
                              <div class="assignment-date">
                                <i class="fas fa-calendar-check"></i>
                                Assigned on <%= new Date(entry.action_details.date).toLocaleDateString() %>
                              </div>
                            <% } %>
                          </div>
                        </div>

                      <% } else if (entry.action_type === 'unassigned' && entry.history_type === 'item') { %>
                        <div class="action-description">
                          <i class="fas fa-arrow-left"></i>
                          <strong>Item was unassigned from this employee</strong>
                        </div>
                        <div class="assignment-details">
                          <div class="item-card unassigned">
                            <div class="item-header">
                              <span class="item-id-badge">
                                <i class="fas fa-tag"></i>
                                <%= entry.cep_brc %>
                              </span>
                              <span class="item-name"><%= entry.item_name %></span>
                            </div>
                            <% if (entry.action_details && entry.action_details.reason) { %>
                              <div class="unassignment-reason">
                                <i class="fas fa-info-circle"></i>
                                Reason: <%= entry.action_details.reason %>
                              </div>
                            <% } %>
                          </div>
                        </div>

                      <% } else if (entry.action_type === 'deleted' && entry.history_type === 'employee') { %>
                        <div class="action-description">
                          <i class="fas fa-user-times"></i>
                          <strong>Employee profile was deleted</strong>
                        </div>
                        <% if (entry.action_details) { %>
                          <div class="deletion-details">
                            <% if (entry.action_details.items_unassigned && entry.action_details.items_unassigned.length > 0) { %>
                              <div class="unassigned-items">
                                <div class="change-field">
                                  <i class="fas fa-laptop"></i>
                                  <strong>Items Unassigned:</strong>
                                </div>
                                <div class="items-list">
                                  <% entry.action_details.items_unassigned.forEach(item => { %>
                                    <div class="item-card">
                                      <span class="item-id-badge">
                                        <i class="fas fa-tag"></i>
                                        <%= item.cep_brc %>
                                      </span>
                                      <span class="item-name"><%= item.name %></span>
                                      <span class="item-type">(<%= item.type %>)</span>
                                    </div>
                                  <% }) %>
                                </div>
                              </div>
                            <% } %>
                            <% if (entry.action_details.software_removed && entry.action_details.software_removed.length > 0) { %>
                              <div class="removed-software">
                                <div class="change-field">
                                  <i class="fas fa-laptop-code"></i>
                                  <strong>Software Licenses Removed:</strong>
                                </div>
                                <div class="software-list">
                                  <% entry.action_details.software_removed.forEach(software => { %>
                                    <span class="software-badge danger">
                                      <i class="fas fa-laptop-code"></i>
                                      <%= software %>
                                    </span>
                                  <% }) %>
                                </div>
                              </div>
                            <% } %>
                            <% if (entry.action_details.deletion_reason) { %>
                              <div class="deletion-reason">
                                <i class="fas fa-info-circle"></i>
                                <strong>Reason:</strong> <%= entry.action_details.deletion_reason %>
                              </div>
                            <% } %>
                          </div>
                        <% } %>

                      <% } else { %>
                        <div class="action-description">
                          <i class="fas fa-question-circle"></i>
                          <strong>Unknown action performed</strong>
                        </div>
                        <% if (entry.action_details) { %>
                          <div class="raw-details">
                            <pre><%= JSON.stringify(entry.action_details, null, 2) %></pre>
                          </div>
                        <% } %>
                      <% } %>
                    </div>

                    <div class="history-footer">
                      <div class="performer-info">
                        <div class="performer-avatar">
                          <i class="fas fa-user-circle"></i>
                        </div>
                        <div class="performer-details">
                          <span class="performer-label">Performed by</span>
                          <% if (entry.performed_by_name) { %>
                            <span class="performer-name">
                              <%= entry.performed_by_name %>
                            </span>
                          <% } else { %>
                            <span class="performer-name">
                              System
                            </span>
                          <% } %>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            <% }) %>
          </div>

          <!-- Pagination -->
          <div class="history-pagination">
            <div class="pagination-info">
              <span class="results-count">
                <i class="fas fa-history"></i>
                Showing <%= startIndex + 1 %> to <%= endIndex %> of <%= totalItems %> events
              </span>
            </div>

            <div class="pagination-controls">
              <% if (totalPages > 1) { %>
                <div class="pagination">
                  <% if (currentPage > 1) { %>
                    <a href="?page=<%= currentPage - 1 %>&perPage=<%= itemsPerPage %>" class="btn btn-sm">
                      <i class="fas fa-chevron-left"></i> Previous
                    </a>
                  <% } %>

                  <span class="page-info">Page <%= currentPage %> of <%= totalPages %></span>

                  <% if (currentPage < totalPages) { %>
                    <a href="?page=<%= currentPage + 1 %>&perPage=<%= itemsPerPage %>" class="btn btn-sm">
                      Next <i class="fas fa-chevron-right"></i>
                    </a>
                  <% } %>
                </div>
              <% } %>

              <div class="items-per-page-compact">
                <select id="historyPerPage">
                  <option value="5" <%= itemsPerPage == 5 ? 'selected' : '' %>>5</option>
                  <option value="10" <%= itemsPerPage == 10 ? 'selected' : '' %>>10</option>
                  <option value="20" <%= itemsPerPage == 20 ? 'selected' : '' %>>20</option>
                  <option value="50" <%= itemsPerPage == 50 ? 'selected' : '' %>>50</option>
                </select>
                <span>per page</span>
              </div>
            </div>
          </div>

        <% } else { %>
          <div class="empty-history">
            <div class="empty-icon">
              <i class="fas fa-history"></i>
            </div>
            <h3>No History Found</h3>
            <p>This employee doesn't have any recorded history yet.</p>
            <div class="empty-actions">
              <a href="/employees/<%= employee.id %>/edit" class="btn btn-primary">
                <i class="fas fa-edit"></i> Edit Employee
              </a>
            </div>
          </div>
        <% } %>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Pagination per page change
  const historyPerPageSelect = document.getElementById('historyPerPage');
  if (historyPerPageSelect) {
    historyPerPageSelect.addEventListener('change', function() {
      const urlParams = new URLSearchParams(window.location.search);
      urlParams.set('perPage', this.value);
      urlParams.delete('page'); // Reset to first page
      window.location.search = urlParams.toString();
    });
  }

  // Filter functionality
  const applyFiltersBtn = document.getElementById('applyHistoryFilters');
  const resetFiltersBtn = document.getElementById('resetHistoryFilters');

  if (applyFiltersBtn) {
    applyFiltersBtn.addEventListener('click', function() {
      const actionFilter = document.getElementById('actionFilter').value;
      const typeFilter = document.getElementById('typeFilter').value;
      const dateFrom = document.getElementById('dateFrom').value;
      const dateTo = document.getElementById('dateTo').value;
      const userFilter = document.getElementById('userFilter').value;

      const params = new URLSearchParams();
      if (actionFilter) params.append('action', actionFilter);
      if (typeFilter) params.append('type', typeFilter);
      if (dateFrom) params.append('dateFrom', dateFrom);
      if (dateTo) params.append('dateTo', dateTo);
      if (userFilter) params.append('user', userFilter);

      window.location.search = params.toString();
    });
  }

  if (resetFiltersBtn) {
    resetFiltersBtn.addEventListener('click', function() {
      window.location.href = window.location.pathname;
    });
  }
});

// Export functionality
function exportHistory() {
  const params = new URLSearchParams(window.location.search);
  params.append('export', 'csv');
  params.append('export_timestamp', new Date().toISOString());

  // Create hidden iframe for download
  const iframe = document.createElement('iframe');
  iframe.style.display = 'none';
  iframe.src = `${window.location.pathname}/export?${params.toString()}`;
  document.body.appendChild(iframe);

  setTimeout(() => {
    document.body.removeChild(iframe);
  }, 2000);
}

// Print functionality
function printHistory() {
  window.print();
}
</script>

<style>
/* Employee History Specific Styles */
.employee-meta {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-top: 0.5rem;
}

.employee-id-display {
  font-family: 'Courier New', monospace;
  background: #f8f9fa;
  padding: 0.25rem 0.75rem;
  border-radius: 6px;
  font-size: 0.9rem;
  font-weight: 600;
  color: #495057;
  border: 1px solid #e9ecef;
}

.employee-name-display {
  background: #e7f3ff;
  color: var(--primary);
  padding: 0.25rem 0.75rem;
  border-radius: 6px;
  font-size: 0.9rem;
  font-weight: 600;
  border: 1px solid #bee5eb;
}

/* History Entry Type Styling */
.employee-entry .history-card {
  border-left: 4px solid var(--primary);
}

.item-entry .history-card {
  border-left: 4px solid var(--success);
}

/* Item Reference in Header */
.item-reference {
  background: #f8f9fa;
  color: var(--success);
  padding: 0.3rem 0.6rem;
  border-radius: 6px;
  font-size: 0.8rem;
  font-weight: 500;
  border: 1px solid #e9ecef;
}

.item-reference i {
  margin-right: 0.3rem;
}

/* Employee Details */
.employee-details {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
  margin-top: 1rem;
}

.detail-item {
  display: flex;
  flex-direction: column;
  gap: 0.3rem;
}

.detail-item.full-width {
  grid-column: 1 / -1;
}

.detail-label {
  font-size: 0.8rem;
  font-weight: 600;
  color: #666;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.detail-value {
  color: #333;
  display: flex;
  align-items: center;
  gap: 0.4rem;
  font-size: 0.9rem;
}

.detail-value i {
  color: var(--primary);
  width: 16px;
}

/* Software Changes */
.software-changes {
  margin-top: 0.75rem;
}

.added-software,
.removed-software {
  margin-bottom: 0.75rem;
}

.change-type {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  font-size: 0.85rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
}

.change-type.added {
  color: var(--success);
}

.change-type.removed {
  color: var(--danger);
}

.software-list {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.software-badge {
  background: #f8f9fa;
  color: var(--primary);
  padding: 0.3rem 0.6rem;
  border-radius: 6px;
  font-size: 0.8rem;
  font-weight: 500;
  border: 1px solid #e9ecef;
  display: flex;
  align-items: center;
  gap: 0.3rem;
}

.software-badge.success {
  background: #d4edda;
  color: var(--success);
  border-color: #c3e6cb;
}

.software-badge.danger {
  background: #f8d7da;
  color: var(--danger);
  border-color: #f5c6cb;
}

.software-badge i {
  font-size: 0.75rem;
}

/* Item Cards */
.item-card {
  background: #f8f9fa;
  border: 1px solid #e9ecef;
  border-radius: 6px;
  padding: 0.75rem;
  margin-bottom: 0.5rem;
}

.item-card.unassigned {
  background: #fff3cd;
  border-color: #ffeaa7;
}

.item-header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.item-id-badge {
  background: var(--primary);
  color: white;
  padding: 0.2rem 0.5rem;
  border-radius: 4px;
  font-size: 0.75rem;
  font-weight: 600;
  font-family: 'Courier New', monospace;
  display: flex;
  align-items: center;
  gap: 0.3rem;
}

.item-id-badge i {
  font-size: 0.7rem;
}

.item-name {
  font-weight: 600;
  color: #333;
}

.item-type {
  color: #666;
  font-size: 0.85rem;
  font-style: italic;
}

.assignment-date,
.unassignment-reason {
  font-size: 0.8rem;
  color: #666;
  display: flex;
  align-items: center;
  gap: 0.3rem;
  margin-top: 0.5rem;
}

.assignment-date i,
.unassignment-reason i {
  color: var(--primary);
}

/* Deletion Details */
.deletion-details {
  margin-top: 1rem;
}

.unassigned-items,
.removed-software {
  margin-bottom: 1rem;
}

.items-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.deletion-reason {
  padding: 0.75rem;
  background: #fff3cd;
  border: 1px solid #ffeaa7;
  border-radius: 6px;
  color: #856404;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.deletion-reason i {
  color: #856404;
}

/* Responsive Design */
@media (max-width: 768px) {
  .employee-meta {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
  }

  .employee-details {
    grid-template-columns: 1fr;
  }

  .item-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.3rem;
  }

  .software-list {
    flex-direction: column;
    align-items: flex-start;
  }
}

@media (max-width: 480px) {
  .history-header .history-title {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
  }

  .item-reference {
    order: -1;
    align-self: flex-start;
  }

  .software-badge {
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
  }
}

/* Print Styles */
@media print {
  .employee-entry .history-card,
  .item-entry .history-card {
    border-left: 2px solid #333 !important;
  }

  .software-badge,
  .item-id-badge {
    border: 1px solid #333 !important;
    background: white !important;
    color: #333 !important;
  }

  .deletion-reason {
    border: 1px solid #333 !important;
    background: white !important;
    color: #333 !important;
  }
}

/* High Contrast Mode */
@media (prefers-contrast: high) {
  .employee-id-display,
  .employee-name-display,
  .item-reference {
    border: 2px solid #333;
  }

  .software-badge,
  .item-card,
  .item-id-badge {
    border: 2px solid #333;
  }
}
</style>
