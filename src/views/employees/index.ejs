<div class="container mx-auto px-4 py-8">
  <!-- Header -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
    <div>
      <h1 class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-2 flex items-center gap-2">
        <i class="fas fa-users"></i> <%= t('employee_management') %>
      </h1>
    </div>
    <div class="flex flex-wrap gap-3 mt-4 md:mt-0">
      <button id="exportEmployeesBtn" class="group px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold rounded-lg transition-all duration-300 flex items-center gap-2 hover:scale-105 hover:shadow-lg">
        <i class="fas fa-download mr-2 group-hover:translate-y-1 transition-transform duration-300"></i> <%= t('export_employee_list') %>
      </button>
      <a href="/employees/new" class="group px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold rounded-lg transition-all duration-300 flex items-center gap-2 hover:scale-105 hover:shadow-lg">
        <i class="fas fa-user-plus mr-2 group-hover:scale-110 transition-transform duration-300"></i> <%= t('add_new_employee') %>
      </a>
    </div>
  </div>

  <!-- Search Bar -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
    <div class="relative w-full md:w-1/2">
      <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 dark:text-gray-500"></i>
      <input type="text" id="employeeSearch"
        class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 transition"
        placeholder="Search employees by name, ID, or department..."
        autocomplete="off"
        value="<%= currentFilters && currentFilters.search || '' %>">
      <div class="absolute left-0 right-0 z-10 bg-white dark:bg-gray-800 rounded-b shadow hidden" id="searchResults"></div>
    </div>
  </div>

  <% if (showDeletedMessage) { %>
    <div class="mb-6 flex items-center gap-2 px-4 py-3 rounded-lg bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 border border-green-200 dark:border-green-700">
      <i class="fas fa-check-circle"></i>
      <span><%= t('employee_deleted') %></span>
    </div>
  <% } %>

  <!-- Advanced Filters Panel -->
  <div class="mb-6 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg shadow">
    <div class="flex items-center justify-between px-6 py-4 cursor-pointer select-none" id="filtersToggle">
      <div class="flex items-center gap-2">
        <i class="fas fa-filter"></i>
        <h3 class="font-semibold text-gray-700 dark:text-gray-200"><%= t('advanced_filters') %></h3>
        <span class="ml-2 inline-flex items-center justify-center w-6 h-6 rounded-full bg-blue-600 text-white text-xs font-bold" id="filterBadge">0</span>
      </div>
      <div class="flex items-center gap-2">
        <span class="text-sm text-gray-500 dark:text-gray-400" id="appliedFiltersPreview"><%= t('no_filters_applied') %></span>
        <i class="fas fa-chevron-down toggle-icon"></i>
      </div>
    </div>
    <div class="px-6 py-4 border-t border-gray-200 dark:border-gray-700 hidden" id="filtersContent">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-4">
        <div>
          <label for="departmentFilter" class="block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1"><%= t('department') %></label>
          <select id="departmentFilter" name="department"
            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
            <option value=""><%= t('all_departments') %></option>
            <% if (typeof departments !== 'undefined') { %>
              <% departments.forEach(dept => { %>
                <option value="<%= dept.id %>" <%= currentFilters && currentFilters.department == dept.id ? 'selected' : '' %>>
                  <%= dept.name %>
                </option>
              <% }) %>
            <% } %>
          </select>
        </div>
        <div>
          <label for="locationFilter" class="block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1">Location</label>
          <select id="locationFilter" name="location"
            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
            <option value=""><%= t('all_locations') %></option>
            <% if (typeof locations !== 'undefined') { %>
              <% locations.forEach(location => { %>
                <option value="<%= location.id %>" <%= currentFilters && currentFilters.location == location.id ? 'selected' : '' %>>
                  <%= location.name %>
                </option>
              <% }) %>
            <% } %>
          </select>
        </div>
        <div>
          <label for="statusFilter" class="block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1"><%= t('employment_status') %></label>
          <select id="statusFilter" name="status"
            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
            <option value="" <%= currentFilters && currentFilters.status === '' ? 'selected' : '' %>><%= t('all_employees') %></option>
            <option value="active" <%= !currentFilters || currentFilters.status === 'active' ? 'selected' : '' %>><%= t('active_employees') %></option>
            <option value="inactive" <%= currentFilters && currentFilters.status === 'inactive' ? 'selected' : '' %>><%= t('former_employees') %></option>
          </select>
        </div>
        <div>
          <label class="block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-1"><%= t('joined_date_range') %></label>
          <div class="flex items-center gap-2">
            <input type="date" id="joinedDateFrom" name="joinedDateFrom"
              class="px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 w-32"
              value="<%= currentFilters && currentFilters.joinedDateFrom || '' %>">
            <span class="text-gray-400 dark:text-gray-500"><%= t('to') %></span>
            <input type="date" id="joinedDateTo" name="joinedDateTo"
              class="px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 w-32"
              value="<%= currentFilters && currentFilters.joinedDateTo || '' %>">
          </div>
        </div>
      </div>
      <div class="flex flex-wrap items-center justify-between gap-4">
        <div class="flex flex-wrap gap-2 text-xs" id="appliedFilters"></div>
        <div class="flex gap-2">
          <button type="button" id="applyFilters" class="group px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold rounded-lg transition-all duration-300 flex items-center gap-2 hover:scale-105 hover:shadow-lg">
            <i class="fas fa-search group-hover:scale-110 transition-transform duration-300"></i> <%= t('apply_filters') %>
          </button>
          <button type="button" id="resetFilters" class="group px-4 py-2 bg-gradient-to-r from-gray-400 to-gray-600 hover:from-gray-500 hover:to-gray-700 text-white font-semibold rounded-lg transition-all duration-300 flex items-center gap-2 hover:scale-105 hover:shadow-lg">
            <i class="fas fa-times group-hover:-rotate-12 transition-transform duration-300"></i> <%= t('reset_all') %>
          </button>
        </div>
      </div>
    </div>
  </div>

  <% if (employees && employees.length > 0) { %>
    <div id="employeesTableBlock">
      <div class="overflow-x-auto bg-white dark:bg-gray-800 rounded-lg shadow">
        <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
          <thead class="bg-gray-50 dark:bg-gray-900">
            <tr>
              <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200"><%= t('name') %></th>
              <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200"><%= t('employee_id') %></th>
              <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200"><%= t('email') %></th>
              <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200"><%= t('department') %></th>
              <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200"><%= t('location') %></th>
              <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200"><%= t('status') %></th>
              <th class="px-4 py-3 text-left font-semibold text-gray-700 dark:text-gray-200"><%= t('actions') %></th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
            <%
            // Sort employees to show active first
            const sortedEmployees = employees.sort((a, b) => {
              if (!a.left_date && b.left_date) return -1;
              if (a.left_date && !b.left_date) return 1;
              return a.name.localeCompare(b.name);
            });
            %>
            <% sortedEmployees.forEach(employee => { %>
              <tr class="<%= employee.left_date ? 'bg-gray-50 dark:bg-gray-900' : '' %>">
                <td class="px-4 py-3">
                  <a href="/employees/<%= employee.id %>" class="font-semibold text-blue-700 dark:text-blue-300 hover:underline">
                    <%= employee.name %>
                  </a>
                  <% if (employee.left_date) { %>
                    <span class="ml-2 inline-flex items-center px-2 py-0.5 rounded bg-gray-300 dark:bg-gray-700 text-xs text-gray-700 dark:text-gray-200">Former</span>
                  <% } %>
                </td>
                <td class="px-4 py-3 font-mono text-xs text-gray-700 dark:text-gray-300"><%= employee.cep %></td>
                <td class="px-4 py-3">
                  <a href="mailto:<%= employee.email %>" class="text-gray-700 dark:text-gray-200 hover:underline"><%= employee.email %></a>
                </td>
                <td class="px-4 py-3">
                  <% if (employee.department_name) { %>
                    <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 text-xs font-semibold">
                      <i class="fas fa-building"></i> <%= employee.department_name %>
                    </span>
                  <% } else { %>
                    <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 text-xs">
                      <i class="fas fa-minus"></i> <%= t('not_assigned') %>
                    </span>
                  <% } %>
                </td>
                <td class="px-4 py-3">
                  <% if (employee.location_name) { %>
                    <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 text-xs font-semibold">
                      <i class="fas fa-map-marker-alt"></i> <%= employee.location_name %>
                    </span>
                  <% } else { %>
                    <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 text-xs">
                      <i class="fas fa-minus"></i> <%= t('not_assigned') %>
                    </span>
                  <% } %>
                </td>
                <td class="px-4 py-3">
                  <%
                    let statusClass = 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300';
                    let statusIcon = 'fas fa-check-circle';
                    let statusText = 'Active';
                    if (employee.left_date) {
                      statusClass = 'bg-gray-300 dark:bg-gray-700 text-gray-700 dark:text-gray-200';
                      statusIcon = 'fas fa-user-times';
                      statusText = 'Former';
                    }
                  %>
                  <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded <%= statusClass %> text-xs font-semibold">
                    <i class="<%= statusIcon %>"></i> <%= statusText %>
                  </span>
                  <% if (employee.joined_date) { %>
                    <div class="text-xs text-gray-500 dark:text-gray-400"><%= t('joined') %> <%= new Date(employee.joined_date).toLocaleDateString() %></div>
                  <% } %>
                </td>
                <td class="px-4 py-3">
                  <div class="flex flex-wrap gap-2">
                    <a href="/employees/<%= employee.id %>" class="group inline-flex items-center px-2 py-1 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-100 rounded-lg transition-all duration-300 hover:scale-105 hover:shadow-lg" title="View Details">
                      <i class="fas fa-eye"></i>
                    </a>
                    <a href="/employees/<%= employee.id %>/edit" class="group inline-flex items-center px-2 py-1 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg transition-all duration-300 hover:scale-105 hover:shadow-lg" title="Edit">
                      <i class="fas fa-edit group-hover:rotate-12 transition-transform duration-300"></i>
                    </a>
                    <a href="/employees/<%= employee.id %>/history" class="group inline-flex items-center px-2 py-1 bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white rounded-lg transition-all duration-300 hover:scale-105 hover:shadow-lg" title="View History">
                      <i class="fas fa-history group-hover:scale-110 transition-transform duration-300"></i>
                    </a>
                    <form style="display: inline;" method="POST" action="/employees/<%= employee.id %>/delete" class="inline-form" onsubmit="return confirmDelete('<%= employee.name %>');">
                      <button type="submit" class="group inline-flex items-center px-2 py-1 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white rounded-lg transition-all duration-300 hover:scale-105 hover:shadow-lg" title="Delete Employee">
                        <i class="fas fa-trash group-hover:scale-110 transition-transform duration-300"></i>
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>

      <!-- Results Summary & Pagination -->
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mt-8">
        <div class="flex flex-col gap-2">
          <span class="text-sm text-gray-700 dark:text-gray-200">
            <i class="fas fa-users"></i>
            <%= t('showing') %> <strong id="employeeCount"><%= employees.length %></strong> <%= t('of') %> <%= typeof totalEmployees !== 'undefined' ? totalEmployees : employees.length %> <%= t('employees') %>
          </span>
          <div class="flex gap-4 text-xs text-gray-500 dark:text-gray-400">
            <span>
              <i class="fas fa-check-circle text-green-600 dark:text-green-400"></i>
              <%= employees.filter(emp => !emp.left_date).length %> <%= t('active') %>
            </span>
            <% if (employees.filter(emp => emp.left_date).length > 0) { %>
              <span>
                <i class="fas fa-user-times text-gray-400 dark:text-gray-500"></i>
                <%= employees.filter(emp => emp.left_date).length %> <%= t('former') %>
              </span>
            <% } %>
          </div>
        </div>
        <div class="flex items-center gap-4">
          <% if (typeof currentPage !== 'undefined' && typeof totalPages !== 'undefined') { %>
            <div class="flex items-center gap-2">
              <% if (currentPage > 1) { %>
                <a href="?page=<%= currentPage - 1 %><%
                  const urlParams = new URLSearchParams(req.query);
                  urlParams.delete('page');
                  for (const [key, value] of urlParams) { %>&<%= key %>=<%= encodeURIComponent(value) %><% } %>"
                  class="pagination-link px-3 py-1 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-100 rounded transition flex items-center gap-1">
                  <i class="fas fa-chevron-left"></i> <%= t('previous') %>
                </a>
              <% } %>
              <span class="text-xs text-gray-500 dark:text-gray-400"><%= t('page') %> <%= currentPage %> <%= t('of') %> <%= totalPages %></span>
              <% if (currentPage < totalPages) { %>
                <a href="?page=<%= currentPage + 1 %><%
                  const urlParams = new URLSearchParams(req.query);
                  urlParams.delete('page');
                  for (const [key, value] of urlParams) { %>&<%= key %>=<%= encodeURIComponent(value) %><% } %>"
                  class="pagination-link px-3 py-1 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-100 rounded transition flex items-center gap-1">
                  Next <i class="fas fa-chevron-right"></i>
                </a>
              <% } %>
            </div>
          <% } %>
          <div>
            <select id="employeesPerPage" class="ml-2 px-2 py-1 border border-gray-300 dark:border-gray-700 rounded bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 text-xs">
              <option value="10" <%= typeof perPage !== 'undefined' && perPage == 10 ? 'selected' : '' %>>10</option>
              <option value="25" <%= typeof perPage !== 'undefined' && perPage == 25 ? 'selected' : '' %>>25</option>
              <option value="50" <%= typeof perPage !== 'undefined' && perPage == 50 ? 'selected' : '' %>>50</option>
              <option value="100" <%= typeof perPage !== 'undefined' && perPage == 100 ? 'selected' : '' %>>100</option>
            </select>
            <span class="text-xs text-gray-500 dark:text-gray-400"><%= t('per_page') %></span>
          </div>
        </div>
      </div>
    </div>
  <% } else { %>
    <div class="flex flex-col items-center justify-center py-16 text-center border border-dashed border-blue-400 rounded bg-blue-50 dark:bg-blue-950 mt-8">
      <div class="text-4xl text-blue-500 mb-2">
        <i class="fas fa-users"></i>
      </div>
      <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-1"><%= t('no_employees_found') %></h3>
      <p class="text-gray-500 dark:text-gray-400 mb-4"><%= t('no_employees_match') %></p>
      <div class="flex gap-2 justify-center">
        <button id="clearFiltersBtn" class="group px-4 py-2 bg-gradient-to-r from-gray-400 to-gray-600 hover:from-gray-500 hover:to-gray-700 text-white font-semibold rounded-lg transition-all duration-300 flex items-center gap-2 hover:scale-105 hover:shadow-lg" style="display: none;">
          <i class="fas fa-times group-hover:-rotate-12 transition-transform duration-300"></i> <%= t('clear_all_filters') %>
        </button>
        <a href="/employees/new" class="group px-4 py-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-semibold rounded-lg transition-all duration-300 flex items-center gap-2 hover:scale-105 hover:shadow-lg">
          <i class="fas fa-user-plus mr-2 group-hover:scale-110 transition-transform duration-300"></i> <%= t('add_first_employee') %>
        </a>
      </div>
    </div>
  <% } %>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  function ajaxLoad(url) {
    fetch(url, { headers: { 'X-Requested-With': 'XMLHttpRequest' } })
      .then(res => res.text())
      .then(html => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const newBlock = doc.getElementById('employeesTableBlock');
        if (newBlock) {
          document.getElementById('employeesTableBlock').innerHTML = newBlock.innerHTML;
          attachHandlers();
        }
      });
  }

  function attachHandlers() {
    // Per-page dropdown
    const perPageSelect = document.getElementById('employeesPerPage');
    if (perPageSelect) {
      perPageSelect.addEventListener('change', function() {
        const url = new URL(window.location.href);
        url.searchParams.set('perPage', this.value);
        url.searchParams.set('page', 1);
        ajaxLoad(url);
      });
    }
    // Pagination links
    document.querySelectorAll('#employeesTableBlock .pagination-link').forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        ajaxLoad(this.href);
      });
    });
  }

  // --- Advanced Filters Logic ---
  const filtersToggle = document.getElementById('filtersToggle');
  const filtersContent = document.getElementById('filtersContent');
  const filterBadge = document.getElementById('filterBadge');
  const appliedFiltersPreview = document.getElementById('appliedFiltersPreview');
  const appliedFilters = document.getElementById('appliedFilters');
  const applyFiltersBtn = document.getElementById('applyFilters');
  const resetFiltersBtn = document.getElementById('resetFilters');
  const clearFiltersBtn = document.getElementById('clearFiltersBtn');

  function getFilterValues() {
    return {
      department: document.getElementById('departmentFilter').value,
      location: document.getElementById('locationFilter').value,
      status: document.getElementById('statusFilter').value,
      joinedDateFrom: document.getElementById('joinedDateFrom').value,
      joinedDateTo: document.getElementById('joinedDateTo').value,
      search: document.getElementById('employeeSearch').value
    };
  }

  function countActiveFilters(filters) {
    let count = 0;
    for (const key in filters) {
      if (filters[key] && !(key === 'status' && filters[key] === 'active')) count++;
    }
    return count;
  }

  function updateFiltersUI() {
    const filters = getFilterValues();
    const count = countActiveFilters(filters);
    filterBadge.textContent = count;
    // Preview
    let preview = [];
    if (filters.department) preview.push('<%= t("department") %>');
    if (filters.location) preview.push('<%= t("location") %>');
    if (filters.status && filters.status !== 'active') preview.push('<%= t("employment_status") %>');
    if (filters.joinedDateFrom || filters.joinedDateTo) preview.push('<%= t("joined_date_range") %>');
    appliedFiltersPreview.textContent = preview.length ? preview.join(', ') : '<%= t("no_filters_applied") %>';
    // Pills
    appliedFilters.innerHTML = '';
    if (filters.department) appliedFilters.innerHTML += `<span class="bg-blue-200 dark:bg-blue-800 text-blue-800 dark:text-blue-200 px-2 py-0.5 rounded">${document.getElementById('departmentFilter').selectedOptions[0].text}</span>`;
    if (filters.location) appliedFilters.innerHTML += `<span class="bg-green-200 dark:bg-green-800 text-green-800 dark:text-green-200 px-2 py-0.5 rounded">${document.getElementById('locationFilter').selectedOptions[0].text}</span>`;
    if (filters.status && filters.status !== 'active') appliedFilters.innerHTML += `<span class="bg-gray-300 dark:bg-gray-700 text-gray-700 dark:text-gray-200 px-2 py-0.5 rounded">${document.getElementById('statusFilter').selectedOptions[0].text}</span>`;
    if (filters.joinedDateFrom || filters.joinedDateTo) appliedFilters.innerHTML += `<span class="bg-yellow-200 dark:bg-yellow-800 text-yellow-800 dark:text-yellow-200 px-2 py-0.5 rounded">${filters.joinedDateFrom || ''} - ${filters.joinedDateTo || ''}</span>`;
    // Show clear filters button if any filter is active
    if (clearFiltersBtn) clearFiltersBtn.style.display = count > 0 ? '' : 'none';
  }

  // Toggle advanced filters panel
  if (filtersToggle && filtersContent) {
    filtersToggle.addEventListener('click', function() {
      filtersContent.classList.toggle('hidden');
      this.querySelector('.toggle-icon').classList.toggle('rotate-180');
    });
  }

  // Update UI on filter change
  ['departmentFilter', 'locationFilter', 'statusFilter', 'joinedDateFrom', 'joinedDateTo', 'employeeSearch'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.addEventListener('input', updateFiltersUI);
  });

  updateFiltersUI();

  // Apply filters
  if (applyFiltersBtn) {
    applyFiltersBtn.addEventListener('click', function() {
      const filters = getFilterValues();
      const url = new URL(window.location.href);
      // Set filters as query params
      Object.entries(filters).forEach(([key, value]) => {
        if (value && !(key === 'status' && value === 'active')) {
          url.searchParams.set(key, value);
        } else {
          url.searchParams.delete(key);
        }
      });
      url.searchParams.set('page', 1);
      window.location.href = url.toString();
    });
  }

  // Reset filters
  if (resetFiltersBtn) {
    resetFiltersBtn.addEventListener('click', function() {
      document.getElementById('departmentFilter').value = '';
      document.getElementById('locationFilter').value = '';
      document.getElementById('statusFilter').value = 'active';
      document.getElementById('joinedDateFrom').value = '';
      document.getElementById('joinedDateTo').value = '';
      document.getElementById('employeeSearch').value = '';
      updateFiltersUI();
    });
  }

  // Clear filters from empty state
  if (clearFiltersBtn) {
    clearFiltersBtn.addEventListener('click', function() {
      const url = new URL(window.location.href);
      ['department', 'location', 'status', 'joinedDateFrom', 'joinedDateTo', 'search', 'page'].forEach(param => url.searchParams.delete(param));
      window.location.href = url.toString();
    });
  }

  attachHandlers();
});
</script>

