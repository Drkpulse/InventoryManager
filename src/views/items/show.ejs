<div class="page-container">
  <div class="page-header-simple">
    <div class="header-title-section">
      <div class="breadcrumb-nav">
        <a href="/items" class="breadcrumb-link">
          <i class="fas fa-boxes"></i> Assets
        </a>
        <i class="fas fa-chevron-right breadcrumb-separator"></i>
        <span class="breadcrumb-current"><%= item.cep_brc %></span>
      </div>
      <h1><%= item.name %></h1>
      <div class="asset-meta">
        <span class="asset-id-display">ID: <%= item.cep_brc %></span>
        <%
          let statusClass = 'status-available';
          let statusIcon = 'fas fa-clock';
          let statusText = 'Available';

          if (item.assigned_to) {
            if (item.condition === 'maintenance') {
              statusClass = 'status-maintenance';
              statusIcon = 'fas fa-wrench';
              statusText = 'Under Maintenance';
            } else if (item.condition === 'retired') {
              statusClass = 'status-retired';
              statusIcon = 'fas fa-archive';
              statusText = 'Retired';
            } else {
              statusClass = 'status-active';
              statusIcon = 'fas fa-check-circle';
              statusText = 'Active';
            }
          }
        %>
        <span class="asset-status <%= statusClass %>">
          <i class="<%= statusIcon %>"></i> <%= statusText %>
        </span>
      </div>
    </div>
    <div class="header-actions">
      <div class="action-buttons">
        <a href="/items" class="btn btn-secondary">
          <i class="fas fa-arrow-left"></i> Back to Assets
        </a>
        <a href="/items/<%= item.id %>/<%= item.cep_brc %>/edit" class="btn btn-warning">
          <i class="fas fa-edit"></i> Edit
        </a>
        <a href="/items/<%= item.id %>/<%= item.cep_brc %>/history" class="btn btn-info">
          <i class="fas fa-history"></i> History
        </a>
        <button onclick="printAssetLabel()" class="btn btn-success">
          <i class="fas fa-print"></i> Print Label
        </button>
        <form style="display: inline;" method="POST" action="/items/<%= item.id %>/<%= item.cep_brc %>/delete" class="inline-form" onsubmit="return confirmDelete('<%= item.name %>');">
          <button type="submit" class="btn btn-danger">
            <i class="fas fa-trash"></i> Delete
          </button>
        </form>
      </div>
    </div>
  </div>

  <div class="content-section">
    <div class="asset-details-layout">
      <!-- Main Information Panel -->
      <div class="main-info-panel">
        <div class="info-section">
          <h2 class="section-title">
            <i class="fas fa-info-circle"></i>
            Asset Information
          </h2>
          <div class="info-grid">
            <div class="info-item">
              <dt>Type</dt>
              <dd>
                <% if (item.type_name) { %>
                  <span class="info-value primary">
                    <i class="fas fa-tag"></i> <%= item.type_name %>
                  </span>
                <% } else { %>
                  <span class="info-value muted">Not specified</span>
                <% } %>
              </dd>
            </div>

            <div class="info-item">
              <dt>Brand</dt>
              <dd>
                <% if (item.brand_name) { %>
                  <span class="info-value">
                    <i class="fas fa-building"></i> <%= item.brand_name %>
                  </span>
                <% } else { %>
                  <span class="info-value muted">Not specified</span>
                <% } %>
              </dd>
            </div>

            <div class="info-item">
              <dt>Model</dt>
              <dd>
                <span class="info-value"><%= item.model || 'Not specified' %></span>
              </dd>
            </div>

            <div class="info-item">
              <dt>Serial Number</dt>
              <dd>
                <% if (item.serial_cod) { %>
                  <span class="info-value code"><%= item.serial_cod %></span>
                <% } else { %>
                  <span class="info-value muted">Not specified</span>
                <% } %>
              </dd>
            </div>

            <div class="info-item">
              <dt>Purchase Price</dt>
              <dd>
                <% if (item.price) { %>
                  <span class="info-value price">â‚¬<%= parseFloat(item.price).toFixed(2) %></span>
                <% } else { %>
                  <span class="info-value muted">Not specified</span>
                <% } %>
              </dd>
            </div>

            <div class="info-item">
              <dt>Date Acquired</dt>
              <dd>
                <% if (item.date_acquired) { %>
                  <span class="info-value">
                    <i class="fas fa-calendar"></i>
                    <%= new Date(item.date_acquired).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %>
                  </span>
                <% } else { %>
                  <span class="info-value muted">Not specified</span>
                <% } %>
              </dd>
            </div>
          </div>
        </div>

                  <!-- Description Section -->
          <% if (item.description) { %>
          <div class="description-section">
            <div class="description-content">
              <h4 class="description-title">
                <i class="fas fa-align-left"></i> Description
              </h4>
              <p class="description-text"><%= item.description %></p>
            </div>
          </div>
          <% } %>

        <% if (item.receipt || item.supplier) { %>
        <div class="info-section">
          <h2 class="section-title">
            <i class="fas fa-receipt"></i>
            Purchase Details
          </h2>

          <div class="info-grid">
            <% if (item.receipt) { %>
            <div class="info-item">
              <dt>Receipt Number</dt>
              <dd>
                <span class="info-value code"><%= item.receipt %></span>
              </dd>
            </div>
            <% } %>

            <% if (item.supplier) { %>
            <div class="info-item">
              <dt>Supplier</dt>
              <dd>
                <span class="info-value"><%= item.supplier %></span>
              </dd>
            </div>
            <% } %>
          </div>
        </div>
        <% } %>
      </div>

      <!-- Assignment Panel -->
      <div class="assignment-panel">
        <div class="assignment-section">
          <h2 class="section-title">
            <i class="fas fa-user"></i>
            Assignment
          </h2>

          <div class="assignment-info">
            <% if (item.assigned_to_name) { %>
              <div class="assigned-to">
                <div class="employee-info">
                  <a href="/employees/<%= item.assigned_to %>" class="employee-link">
                    <div class="employee-avatar">
                      <i class="fas fa-user"></i>
                    </div>
                    <div class="employee-details">
                      <span class="employee-name"><%= item.assigned_to_name %></span>
                      <% if (item.department_name) { %>
                        <span class="employee-dept"><%= item.department_name %></span>
                      <% } %>
                    </div>
                  </a>
                </div>

                <% if (item.date_assigned) { %>
                  <div class="assignment-date">
                    <i class="fas fa-calendar-check"></i>
                    Assigned on <%= new Date(item.date_assigned).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %>
                  </div>
                <% } %>
              </div>

              <div class="assignment-actions">
                <form method="POST" action="/items/<%= item.id %>/<%= item.cep_brc %>/unassign" class="inline-form">
                  <button type="submit" class="btn btn-warning btn-block">
                    <i class="fas fa-user-minus"></i> Unassign Asset
                  </button>
                </form>
              </div>
            <% } else { %>
              <div class="unassigned-state">
                <div class="unassigned-icon">
                  <i class="fas fa-user-slash"></i>
                </div>
                <div class="unassigned-text">
                  <h3>Not Assigned</h3>
                  <p>This asset is currently available for assignment</p>
                </div>
              </div>

              <div class="assignment-actions">
                <a href="/items/<%= item.id %>/<%= item.cep_brc %>/assign" class="btn btn-primary btn-block">
                  <i class="fas fa-user-plus"></i> Assign Asset
                </a>
              </div>
            <% } %>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions-section">
          <h3 class="actions-title">Quick Actions</h3>
          <div class="actions-list">
            <a href="/items/<%= item.id %>/<%= item.cep_brc %>/edit" class="action-item">
              <i class="fas fa-edit"></i>
              <span>Edit Details</span>
            </a>
            <a href="/items/<%= item.id %>/<%= item.cep_brc %>/history" class="action-item">
              <i class="fas fa-history"></i>
              <span>View History</span>
            </a>
            <button onclick="printAssetLabel()" class="action-item action-button">
              <i class="fas fa-print"></i>
              <span>Print Label</span>
            </button>
            <% if (item.assigned_to) { %>
              <form method="POST" action="/items/<%= item.id %>/<%= item.cep_brc %>/unassign" class="inline-form">
                <button type="submit" class="action-item action-button">
                  <i class="fas fa-user-minus"></i>
                  <span>Unassign</span>
                </button>
              </form>
            <% } else { %>
              <a href="/items/<%= item.id %>/<%= item.cep_brc %>/assign" class="action-item">
                <i class="fas fa-user-plus"></i>
                <span>Assign</span>
              </a>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
/* Additional styles for description section */
.description-section {
  margin-bottom: 1.5rem;
  padding: 1rem;
  background: #f8f9fa;
  border-left: 4px solid #007bff;
  border-radius: 0 4px 4px 0;
}

.description-title {
  margin: 0 0 0.75rem 0;
  color: #495057;
  font-size: 1rem;
  font-weight: 600;
  display: flex;
  align-items: center;
}

.description-title i {
  margin-right: 0.5rem;
  color: #007bff;
}

.description-text {
  margin: 0;
  color: #6c757d;
  line-height: 1.5;
  font-size: 0.95rem;
  white-space: pre-wrap;
}
</style>

<script>
function confirmDelete(assetName) {
  return confirm(`Are you sure you want to delete "${assetName}"? This action cannot be undone and will remove all history associated with this asset.`);
}

function printAssetLabel() {
  const printWindow = window.open('', '_blank');
  printWindow.document.write(`
    <html>
      <head>
        <title>Asset Label - <%= item.cep_brc %></title>
        <style>
          body {
            font-family: Arial, sans-serif;
            padding: 20px;
            margin: 0;
            background: white;
          }
          .label {
            border: 2px solid #000;
            padding: 20px;
            width: 300px;
            text-align: center;
            background: white;
          }
          .asset-id {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 8px;
            font-family: 'Courier New', monospace;
          }
          .asset-name {
            font-size: 16px;
            margin-bottom: 12px;
            font-weight: 600;
          }
          .details {
            font-size: 12px;
            line-height: 1.6;
            text-align: left;
          }
          .details div {
            margin-bottom: 4px;
          }
        </style>
      </head>
      <body>
        <div class="label">
          <div class="asset-id"><%= item.cep_brc %></div>
          <div class="asset-name"><%= item.name %></div>
          <div class="details">
            <div><strong>Type:</strong> <%= item.type_name || 'N/A' %></div>
            <div><strong>Brand:</strong> <%= item.brand_name || 'N/A' %></div>
            <% if (item.serial_cod) { %><div><strong>S/N:</strong> <%= item.serial_cod %></div><% } %>
            <% if (item.assigned_to_name) { %><div><strong>Assigned:</strong> <%= item.assigned_to_name %></div><% } %>
          </div>
        </div>
      </body>
    </html>
  `);
  printWindow.document.close();
  printWindow.print();
  printWindow.close();
}
</script>
