<div class="page-container">
  <div class="page-header-simple">
    <h1><i class="fas fa-print"></i> Printer Management</h1>
    <div class="header-actions">
      <div class="action-buttons">
        <a href="/printers/new" class="btn btn-primary">
          <i class="fas fa-plus"></i> Add New Printer
        </a>
      </div>
    </div>
  </div>

<% if (locals.messages && messages.success) { %>
  <div class="alert alert-success">
    <i class="fas fa-check-circle"></i>
    <%= messages.success %>
  </div>
<% } %>

<div class="table-controls">
  <div class="table-info">
    <span>Showing <%= printers.length %> of <%= totalPrinters %> printers</span>
  </div>
  <div class="table-filters">
    <select class="form-control" onchange="filterPrinters('client', this.value)">
      <option value="">All Clients</option>
      <% clients.forEach(client => { %>
        <option value="<%= client.id %>" <%= filters.client == client.id ? 'selected' : '' %>>
          <%= client.name %>
        </option>
      <% }); %>
    </select>
  </div>
</div>

<div class="table-container">
  <table class="data-table">
    <thead>
      <tr>
        <th>Supplier</th>
        <th>Model</th>
        <th>Client</th>
        <th>Cost</th>
        <th>Status</th>
        <th>Employee</th>
        <th>Created</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% if (printers.length === 0) { %>
        <tr>
          <td colspan="8" class="text-center">
            <div class="empty-state">
              <i class="fas fa-print"></i>
              <h3>No printers found</h3>
              <p>Start by adding your first printer.</p>
              <a href="/printers/new" class="btn btn-primary">Add New Printer</a>
            </div>
          </td>
        </tr>
      <% } else { %>
        <% printers.forEach(printer => { %>
          <tr>
            <td><%= printer.supplier %></td>
            <td><%= printer.model || '-' %></td>
            <td>
              <a href="/clients/<%= printer.client_id %>">
                <%= printer.client_name %> (<%= printer.client_code %>)
              </a>
            </td>
            <td>
              <% if (printer.cost) { %>
                â‚¬<%= parseFloat(printer.cost).toFixed(2) %>
              <% } else { %>
                <span class="text-muted">-</span>
              <% } %>
            </td>
            <td>
              <% if (printer.status_name) { %>
                <span class="badge badge-info"><%= printer.status_name %></span>
              <% } else { %>
                <span class="text-muted">-</span>
              <% } %>
            </td>
            <td>
              <% if (printer.employee_name) { %>
                <%= printer.employee_name %>
              <% } else { %>
                <span class="text-muted">Unassigned</span>
              <% } %>
            </td>
            <td><%= new Date(printer.created_at).toLocaleDateString() %></td>
            <td>
              <div class="action-buttons">
                <a href="/printers/<%= printer.id %>" class="btn btn-sm btn-outline-primary">
                  <i class="fas fa-eye"></i>
                </a>
                <a href="/printers/<%= printer.id %>/edit" class="btn btn-sm btn-outline-secondary">
                  <i class="fas fa-edit"></i>
                </a>
                <button class="btn btn-sm btn-outline-danger" onclick="confirmDelete(<%= printer.id %>)">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        <% }); %>
      <% } %>
    </tbody>
  </table>
</div>

<script>
function filterPrinters(type, value) {
  const url = new URL(window.location);
  if (value) {
    url.searchParams.set(type, value);
  } else {
    url.searchParams.delete(type);
  }
  window.location = url;
}

function confirmDelete(printerId) {
  if (confirm('Are you sure you want to delete this printer? This action cannot be undone.')) {
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = `/printers/${printerId}/delete`;
    document.body.appendChild(form);
    form.submit();
  }
}
</script>

</div> <!-- end page-container -->