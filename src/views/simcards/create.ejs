<div class="page-container">
  <div class="page-header-simple">
    <h1><i class="fas fa-plus"></i> Add New SIM Card</h1>
    <div class="header-actions">
      <div class="action-buttons">
        <a href="/simcards" class="btn btn-secondary">
          <i class="fas fa-arrow-left"></i> Back to SIM Cards
        </a>
      </div>
    </div>
  </div>

<% if (locals.errors && errors.length > 0) { %>
  <div class="alert alert-danger">
    <i class="fas fa-exclamation-triangle"></i>
    <strong>Please fix the following errors:</strong>
    <ul class="mb-0 mt-2">
      <% errors.forEach(error => { %>
        <li><%= error %></li>
      <% }); %>
    </ul>
  </div>
<% } %>

<div class="form-container">
  <form method="POST" action="/simcards" class="needs-validation" novalidate>
    <div class="form-section">
      <h3><i class="fas fa-info-circle"></i> SIM Card Information</h3>
      
      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="sim_number" class="required">SIM Number</label>
          <input 
            type="text" 
            class="form-control" 
            id="sim_number" 
            name="sim_number" 
            value="<%= locals.formData ? formData.sim_number : '' %>"
            placeholder="e.g., SIM001234567"
            required
          >
          <div class="invalid-feedback">
            Please provide a SIM number.
          </div>
        </div>
        
        <div class="form-group col-md-6">
          <label for="carrier" class="required">Carrier</label>
          <input 
            type="text" 
            class="form-control" 
            id="carrier" 
            name="carrier" 
            value="<%= locals.formData ? formData.carrier : '' %>"
            placeholder="e.g., Vodafone, MEO, NOS"
            required
          >
          <div class="invalid-feedback">
            Please provide a carrier name.
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="client_id" class="required">Client</label>
          <select 
            class="form-control" 
            id="client_id" 
            name="client_id" 
            required
          >
            <option value="">Select a client...</option>
            <% clients.forEach(client => { %>
              <option value="<%= client.id %>" 
                <%= (locals.formData && formData.client_id == client.id) || (req.query.client_id == client.id) ? 'selected' : '' %>>
                <%= client.name %> (<%= client.client_id %>)
              </option>
            <% }); %>
          </select>
          <div class="invalid-feedback">
            Please select a client.
          </div>
        </div>
        
        <div class="form-group col-md-6">
          <label for="status_id" class="required">Status</label>
          <select 
            class="form-control" 
            id="status_id" 
            name="status_id" 
            required
          >
            <option value="">Select a status...</option>
            <% statuses.forEach(status => { %>
              <option value="<%= status.id %>" 
                <%= locals.formData && formData.status_id == status.id ? 'selected' : '' %>>
                <%= status.name %>
              </option>
            <% }); %>
          </select>
          <div class="invalid-feedback">
            Please select a status.
          </div>
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group col-md-6">
          <label for="pda_id">Assigned PDA (Optional)</label>
          <select 
            class="form-control" 
            id="pda_id" 
            name="pda_id"
          >
            <option value="">No PDA assigned</option>
            <% pdas.forEach(pda => { %>
              <option value="<%= pda.id %>" 
                <%= locals.formData && formData.pda_id == pda.id ? 'selected' : '' %>>
                <%= pda.serial_number %> (<%= pda.client_name %>)
              </option>
            <% }); %>
          </select>
          <small class="form-text text-muted">
            Optional: Assign this SIM card to a specific PDA
          </small>
        </div>
        
        <div class="form-group col-md-6">
          <label for="monthly_cost">Monthly Cost (â‚¬)</label>
          <input 
            type="number" 
            step="0.01" 
            class="form-control" 
            id="monthly_cost" 
            name="monthly_cost" 
            value="<%= locals.formData ? formData.monthly_cost : '' %>"
            placeholder="e.g., 25.00"
          >
          <small class="form-text text-muted">
            Monthly cost in euros (optional)
          </small>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary">
        <i class="fas fa-save"></i> Create SIM Card
      </button>
      <a href="/simcards" class="btn btn-secondary">
        <i class="fas fa-times"></i> Cancel
      </a>
    </div>
  </form>
</div>

<script>
// Bootstrap form validation
(function() {
  'use strict';
  window.addEventListener('load', function() {
    var forms = document.getElementsByClassName('needs-validation');
    var validation = Array.prototype.filter.call(forms, function(form) {
      form.addEventListener('submit', function(event) {
        if (form.checkValidity() === false) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  }, false);
})();

// Pre-select client if coming from client page
const urlParams = new URLSearchParams(window.location.search);
const clientId = urlParams.get('client_id');
if (clientId) {
  document.getElementById('client_id').value = clientId;
}
</script>

</div> <!-- end page-container -->