<div class="min-h-screen bg-gray-50 dark:bg-gray-900 py-8 px-4">
  <div class="max-w-3xl mx-auto">
    <!-- Header -->
    <div class="flex items-center justify-between mb-8">
      <h1 class="text-2xl font-bold text-gray-800 dark:text-gray-100 flex items-center gap-2">
        <i class="fas fa-history"></i> SIM Card History: <%= simCard.sim_number %>
      </h1>
      <a href="/simcards/<%= simCard.id %>" class="inline-flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-100 rounded-md font-semibold transition">
        <i class="fas fa-arrow-left mr-2"></i> Back to SIM Card
      </a>
    </div>

    <!-- SIM Card Info -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-8">
      <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-4 flex items-center gap-2">
        <i class="fas fa-sim-card"></i> SIM Card Details
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <span class="block text-xs font-semibold text-gray-500 dark:text-gray-400 mb-1">SIM Number</span>
          <span class="text-gray-800 dark:text-gray-100"><%= simCard.sim_number %></span>
        </div>
        <div>
          <span class="block text-xs font-semibold text-gray-500 dark:text-gray-400 mb-1">Carrier</span>
          <span class="text-gray-800 dark:text-gray-100"><%= simCard.carrier %></span>
        </div>
      </div>
    </div>

    <!-- History Timeline -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
      <h3 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-6 flex items-center gap-2">
        <i class="fas fa-clock"></i> Change History
      </h3>
      <% if (history.length === 0) { %>
        <div class="flex flex-col items-center justify-center py-12 text-center border border-dashed border-blue-400 rounded bg-blue-50 dark:bg-blue-950">
          <div class="text-4xl text-blue-500 mb-2">
            <i class="fas fa-history"></i>
          </div>
          <h4 class="text-lg font-semibold text-gray-700 dark:text-gray-200 mb-1">No history found</h4>
          <p class="text-gray-500 dark:text-gray-400">No changes have been recorded for this SIM card yet.</p>
        </div>
      <% } else { %>
        <div class="relative pl-6 before:absolute before:top-0 before:left-2 before:w-1 before:h-full before:bg-gray-200 dark:before:bg-gray-700 before:rounded">
          <% history.forEach(entry => { %>
            <div class="relative mb-10 group">
              <div class="absolute -left-2 top-2 w-5 h-5 flex items-center justify-center rounded-full
                <%= entry.action_type === 'created' ? 'bg-green-100 dark:bg-green-900 text-green-600 dark:text-green-300' :
                    entry.action_type === 'updated' ? 'bg-yellow-100 dark:bg-yellow-900 text-yellow-600 dark:text-yellow-300' :
                    entry.action_type === 'deleted' ? 'bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-300' :
                    'bg-blue-100 dark:bg-blue-900 text-blue-600 dark:text-blue-300' %>">
                <% if (entry.action_type === 'created') { %>
                  <i class="fas fa-plus"></i>
                <% } else if (entry.action_type === 'updated') { %>
                  <i class="fas fa-edit"></i>
                <% } else if (entry.action_type === 'deleted') { %>
                  <i class="fas fa-trash"></i>
                <% } else { %>
                  <i class="fas fa-info"></i>
                <% } %>
              </div>
              <div class="ml-8">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-1">
                  <h4 class="font-semibold text-gray-800 dark:text-gray-100 text-base">
                    <%= entry.action_type.charAt(0).toUpperCase() + entry.action_type.slice(1) %> SIM Card
                  </h4>
                  <div class="flex flex-wrap gap-4 text-xs text-gray-500 dark:text-gray-400">
                    <span>
                      <i class="fas fa-calendar"></i>
                      <%= new Date(entry.created_at).toLocaleDateString() %>
                      <%= new Date(entry.created_at).toLocaleTimeString() %>
                    </span>
                    <span>
                      <i class="fas fa-user"></i>
                      <%= entry.performed_by_name || 'System' %>
                    </span>
                  </div>
                </div>
                <div class="pl-1">
                  <% if (entry.action_type === 'created') { %>
                    <p class="text-gray-700 dark:text-gray-200 mb-2">SIM card was created with the following details:</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 bg-gray-50 dark:bg-gray-900 rounded p-3">
                      <% const details = JSON.parse(entry.action_details); %>
                      <% Object.keys(details).forEach(key => { %>
                        <div>
                          <span class="font-semibold text-gray-700 dark:text-gray-200"><%= key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) %>:</span>
                          <span class="text-gray-800 dark:text-gray-100"> <%= details[key] %></span>
                        </div>
                      <% }); %>
                    </div>
                  <% } else if (entry.action_type === 'updated') { %>
                    <p class="text-gray-700 dark:text-gray-200 mb-2">The following changes were made:</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 bg-yellow-50 dark:bg-yellow-900 rounded p-3">
                      <% const changes = JSON.parse(entry.action_details); %>
                      <% Object.keys(changes).forEach(key => { %>
                        <div>
                          <span class="font-semibold text-gray-700 dark:text-gray-200"><%= key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) %>:</span>
                          <span class="text-red-600 dark:text-red-300 line-through ml-1"><%= changes[key].from || 'None' %></span>
                          <i class="fas fa-arrow-right mx-1 text-gray-400"></i>
                          <span class="text-green-700 dark:text-green-300"><%= changes[key].to || 'None' %></span>
                        </div>
                      <% }); %>
                    </div>
                  <% } else if (entry.action_type === 'deleted') { %>
                    <p class="text-gray-700 dark:text-gray-200 mb-2">SIM card was deleted with the following final state:</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 bg-red-50 dark:bg-red-900 rounded p-3">
                      <% const details = JSON.parse(entry.action_details); %>
                      <% Object.keys(details).forEach(key => { %>
                        <div>
                          <span class="font-semibold text-gray-700 dark:text-gray-200"><%= key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) %>:</span>
                          <span class="text-gray-800 dark:text-gray-100"> <%= details[key] %></span>
                        </div>
                      <% }); %>
                    </div>
                  <% } %>
                </div>
              </div>
            </div>
          <% }); %>
        </div>
      <% } %>
    </div>
  </div>
</div>
